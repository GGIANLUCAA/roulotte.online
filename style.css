    :root{
      --primary:#2563eb;
      --primary-600:#1d4ed8;
      --accent:#10b981;
      --bg:#f6f7fb;
      --panel:#ffffff;
      --surface:#0f172a;
      --text:#0f172a;
      --muted:#475569;
      --border:rgba(15,23,42,.12);
      --shadow-xs:0 4px 10px rgba(15,23,42,.06);
      --shadow-sm:0 8px 18px rgba(15,23,42,.08);
      --shadow:0 12px 26px rgba(15,23,42,.10);
      --radius:14px;
      --space-1:6px; --space-2:10px; --space-3:14px; --space-4:18px;
      --font-xs:.78rem; --font-sm:.9rem; --font-md:1.05rem; --font-lg:1.6rem;
      --transition: all .25s ease;
    }
    :root[data-theme="dark"]{
      --primary:#2563eb;
      --primary-600:#1d4ed8;
      --accent:#10b981;
      --bg:#0b1220;
      --panel:#0f172a;
      --surface:#0f172a;
      --text:#e5e7eb;
      --muted:#a7b0c0;
      --border:rgba(255,255,255,.10);
      --shadow-xs:0 4px 10px rgba(0,0,0,.25);
      --shadow-sm:0 8px 22px rgba(0,0,0,.35);
      --shadow:0 12px 34px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 620px at 20% 0%, rgba(37,99,235,.16) 0%, transparent 60%),
        radial-gradient(900px 620px at 90% 10%, rgba(16,185,129,.10) 0%, transparent 60%),
                  var(--bg);
      color:var(--text);
      line-height:1.45;
      transition:var(--transition);
    }
    :root[data-theme="dark"] body{
      background:
        radial-gradient(1100px 700px at 20% 0%, rgba(37,99,235,.25) 0%, transparent 55%),
        radial-gradient(900px 600px at 90% 20%, rgba(16,185,129,.16) 0%, transparent 55%),
        var(--bg);
    }
    a{color:inherit}
    .skip-link{
      position:absolute;
      left:-9999px;
      top:0;
      background:#fff;
      color:#000;
      padding:.75rem 1rem;
      border-radius:10px;
      z-index:9999;
    }
    .skip-link:focus{left:12px;top:12px;outline:3px solid #000}
    .container{max-width:1150px;margin:0 auto;padding:var(--space-4)}
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:var(--space-3);
      padding:var(--space-3) 0;
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: saturate(1.3) blur(6px);
      background:rgba(255,255,255,.55);
      border-bottom:1px solid var(--border);
      transition:var(--transition);
    }
    :root[data-theme="dark"] header{background:rgba(255,255,255,.06)}
    body.scrolled header{box-shadow:0 6px 18px rgba(0,0,0,.14)}
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      text-decoration:none;
    }
    .logo{
      width:40px;height:40px;
      display:grid;place-items:center;
      border-radius:12px;
      background:linear-gradient(135deg, rgba(37,99,235,.9), rgba(16,185,129,.75));
      box-shadow:var(--shadow-sm);
      flex:0 0 auto;
    }
    .brand h1{font-size:var(--font-md);font-weight:800;letter-spacing:.2px}
    .brand p{font-size:var(--font-sm);color:var(--muted)}
    .home-hero::before{
      content:"";
      display:block;
      height:4px;
      border-radius:999px;
      background:linear-gradient(90deg, var(--primary), var(--accent));
      box-shadow:var(--shadow-xs);
      margin-bottom:14px;
    }
    nav{display:flex;align-items:center;gap:var(--space-2)}
    .nav-toggle{display:none;border:1px solid var(--border);background:rgba(255,255,255,.55);border-radius:10px;padding:8px 10px;font-weight:800}
    @media (max-width: 640px){
      nav{display:none}
      nav.open{display:flex;flex-direction:column;gap:8px}
      .nav-toggle{display:inline-flex}
    }
    .nav-link{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:10px;border:1px solid var(--border);
      background:rgba(255,255,255,.55);text-decoration:none;color:var(--text);font-weight:700;
      transition:var(--transition);
    }
    .nav-link:hover{background:rgba(255,255,255,.75)}
    :root[data-theme="dark"] .nav-link{background:rgba(255,255,255,.06)}
    :root[data-theme="dark"] .nav-link:hover{background:rgba(255,255,255,.10)}
    .actions{display:flex;align-items:center;gap:var(--space-2)}
    .btn{
      appearance:none;
      border:1px solid var(--border);
      background:rgba(255,255,255,.65);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
      transition:var(--transition);
    }
    :root[data-theme="dark"] .btn{background:rgba(255,255,255,.06)}
    .btn:hover{background:rgba(255,255,255,.80)}
    :root[data-theme="dark"] .btn:hover{background:rgba(255,255,255,.10)}
    .btn-primary{background:var(--primary);border-color:transparent;color:#fff;box-shadow:var(--shadow-xs)}
    .btn-primary{background:linear-gradient(90deg, var(--primary), #3b82f6)}
    .btn-primary:hover{transform:translateY(-1px);background:linear-gradient(90deg, var(--primary-600), #2563eb)}
    .btn:focus-visible{outline:3px solid rgba(37,99,235,.45);outline-offset:3px}
    :root[data-theme="dark"] .btn:focus-visible{outline:3px solid rgba(255,255,255,.85)}
    .icon-btn{
      width:40px;height:40px;
      padding:0;display:inline-grid;place-items:center;
      border-radius:12px;
    }
    .icon-btn svg{width:22px;height:22px;display:block}
    .hero{
      padding:var(--space-3) 0 var(--space-2);
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:var(--space-3);
      align-items:start;
    }
    .hero-card{
      border:1px solid var(--border);
      background:rgba(255,255,255,.62);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:var(--space-3);
      transition:var(--transition);
    }
    :root[data-theme="dark"] .hero-card{background:rgba(255,255,255,.04)}
    .hero h2{font-size:var(--font-lg);letter-spacing:-.3px}
    .hero p{color:var(--muted);margin-top:8px}
    .controls{
      display:grid;
      grid-template-columns: 1fr 190px 190px 190px 240px 180px;
      gap:var(--space-2);
      margin-top:var(--space-2);
    }
    .price-range{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .check-pill{
      display:flex;
      align-items:center;
      gap:10px;
      min-height:46px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.65);
      border-radius:12px;
      padding:10px 12px;
      font-weight:800;
      cursor:pointer;
      user-select:none;
    }
    :root[data-theme="dark"] .check-pill{background:rgba(255,255,255,.06)}
    .check-pill input{width:auto}
    .field{
      display:grid;
      gap:6px;
    }
    label{font-size:.9rem;color:var(--muted)}
    input,select{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.65);
      color:var(--text);
      outline:none;
    }
    :root[data-theme="dark"] input,:root[data-theme="dark"] select{background:rgba(255,255,255,.06)}
    input::placeholder{color:rgba(231,234,240,.55)}
    input:focus,select:focus{border-color:rgba(37,99,235,.75);box-shadow:0 0 0 3px rgba(37,99,235,.25)}
    .meta-card{
      display:grid;
      gap:10px;
    }
    .pill{
      border:1px solid var(--border);
      background:rgba(255,255,255,.55);
      border-radius:999px;
      padding:10px 12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-weight:600;
    }
    :root[data-theme="dark"] .pill{background:rgba(255,255,255,.04)}
    .pill span{color:var(--muted);font-weight:600}
    main{padding:10px 0 30px}
    .results-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin:10px 0 14px;
    }
    .results-head h3{font-size:1.05rem}
    .sr-only{
      position:absolute;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:var(--space-3);
    }
    .card{
      border:1px solid var(--border);
      background:rgba(255,255,255,.62);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow:0 10px 24px rgba(0,0,0,.25);
      display:flex;
      flex-direction:column;
      min-height: 260px;
      transition:var(--transition);
      position: relative;
    }
    .card:hover{transform:translateY(-2px);box-shadow:0 16px 34px rgba(0,0,0,.32)}
    :root[data-theme="dark"] .card{background:rgba(255,255,255,.04)}
    .card-media{
      aspect-ratio:16/9;
      background:linear-gradient(135deg, rgba(37,99,235,.18), rgba(16,185,129,.14));
      display:grid;
      place-items:center;
      color:rgba(229,231,235,.85);
      border-bottom:1px solid var(--border);
      overflow:hidden;
    }
    .card-media img{width:100%;height:100%;object-fit:cover;display:block;opacity:1;transition:opacity .3s ease, transform .22s ease}
    .card-media img.loaded{opacity:1}
    .card:hover .card-media img{transform:scale(1.08)}
    .card-body{padding:var(--space-2);display:grid;gap:var(--space-2)}
    .card-title{font-size:var(--font-md);font-weight:800;letter-spacing:-.2px}
    .card-sub{color:var(--muted);font-size:.92rem;display:flex;flex-wrap:wrap;gap:8px}
    .tag{
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.55);
      border-radius:999px;
      padding:6px 10px;
      font-weight:700;
      font-size:.78rem;
    }
    :root[data-theme="dark"] .tag{background:rgba(255,255,255,.04)}
    .tag.state{border-color:transparent}
    .tag.state::before{content:"";width:8px;height:8px;border-radius:50%;display:inline-block}
    .tag.state[data-state="Nuovo"]{background:rgba(37,99,235,.12);color:#1d4ed8}
    .tag.state[data-state="Nuovo"]::before{background:#2563eb}
    .tag.state[data-state="Venduto"]{background:rgba(239,68,68,.12);color:#b91c1c}
    .tag.state[data-state="Venduto"]::before{background:#ef4444}
    .tag.state[data-state="Ottimo"], .tag.state[data-state="Excellent"]{background:rgba(34,197,94,.12);color:#166534}
    .tag.state[data-state="Ottimo"]::before, .tag.state[data-state="Excellent"]::before{background:#22c55e}
    .tag.state[data-state="Buono"], .tag.state[data-state="Good"]{background:rgba(16,185,129,.12);color:#115e59}
    .tag.state[data-state="Buono"]::before, .tag.state[data-state="Good"]::before{background:#10b981}
    .tag.state[data-state="Da sistemare"], .tag.state[data-state="To Fix"]{background:rgba(245,158,11,.12);color:#92400e}
    .tag.state[data-state="Da sistemare"]::before, .tag.state[data-state="To Fix"]::before{background:#f59e0b}
    .card-actions{display:flex;justify-content:space-between;gap:var(--space-2);align-items:center;margin-top:auto}
    .price{font-weight:900;letter-spacing:-.2px}
    .skeleton{
      --sk-bg: rgba(15,23,42,.07);
      --sk-hi: rgba(15,23,42,.12);
      background: linear-gradient(90deg, var(--sk-bg) 25%, var(--sk-hi) 37%, var(--sk-bg) 63%);
      background-size: 400% 100%;
      animation: sk 1.25s ease-in-out infinite;
    }
    :root[data-theme="dark"] .skeleton{
      --sk-bg: rgba(255,255,255,.06);
      --sk-hi: rgba(255,255,255,.12);
    }
    @keyframes sk{
      0%{background-position: 100% 0}
      100%{background-position: 0 0}
    }
    .card-media.skeleton{border-bottom:1px solid var(--border);color:transparent}
    .sk-line{height:12px;border-radius:10px}
    .sk-title{height:16px;border-radius:10px;width:78%}
    .sk-tags{display:flex;gap:8px;flex-wrap:wrap}
    .sk-tag{height:22px;border-radius:999px;width:72px}
    .sk-tag.wide{width:110px}
    .sk-actions{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .sk-price{height:16px;border-radius:10px;width:92px}
    .sk-btn{height:36px;border-radius:12px;width:110px}
    dialog{
      border:none;
      border-radius:18px;
      padding:0;
      width:min(780px, calc(100vw - 24px));
      background:var(--panel);
      color:var(--text);
      box-shadow:0 30px 70px rgba(0,0,0,.55);
    }
    :root[data-theme="dark"] dialog{background:var(--panel)}
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .dialog-head{
      display:flex;justify-content:space-between;align-items:flex-start;gap:12px;
      padding:16px 16px 10px;
      border-bottom:1px solid var(--border);
    }
    .dialog-head h4{font-size:1.15rem;font-weight:900}
    .dialog-body{padding:16px;display:grid;gap:12px}
    .gallery{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:var(--space-2);
    }
    .gallery img{width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:14px;border:1px solid var(--border);opacity:0;transition:opacity .3s ease, transform .2s ease}
    .gallery img.loaded{opacity:1}
    .gallery img:hover{transform:scale(1.02)}
    .card-ribbon{
      position:absolute;
      top:8px;left:-16px;
      padding:6px 16px;
      font-weight:900;
      font-size:.72rem;
      color:#fff;
      transform:rotate(-28deg);
      border-radius:8px;
      box-shadow:var(--shadow-xs);
      pointer-events:none;
    }
    .card-ribbon[data-state="Nuovo"]{background:linear-gradient(90deg,#2563eb,#3b82f6)}
    .card-ribbon[data-state="Venduto"]{background:linear-gradient(90deg,#ef4444,#dc2626)}
    .card-ribbon[data-state="Ottimo"], .card-ribbon[data-state="Excellent"]{background:linear-gradient(90deg,#22c55e,#16a34a)}
    .card-ribbon[data-state="Buono"], .card-ribbon[data-state="Good"]{background:linear-gradient(90deg,#10b981,#0ea5e9)}
    .card-ribbon[data-state="Da sistemare"], .card-ribbon[data-state="To Fix"]{background:linear-gradient(90deg,#f59e0b,#d97706)}
    .price{
      font-weight:900;letter-spacing:-.2px;
      background:linear-gradient(90deg, rgba(37,99,235,.14), rgba(16,185,129,.14));
      border:1px solid var(--border);
      border-radius:999px;
      padding:6px 12px;
    }
    :root[data-theme="dark"] .price{background:linear-gradient(90deg, rgba(37,99,235,.18), rgba(16,185,129,.18))}
    .empty{
      border:1px dashed var(--border);
      background:rgba(255,255,255,.62);
      border-radius:var(--radius);
      padding:18px;
      color:var(--muted);
    }
    :root[data-theme="dark"] .empty{background:rgba(255,255,255,.03);border-color:rgba(255,255,255,.2)}
    .calc-card{
      border:1px solid var(--border);
      background:rgba(255,255,255,.62);
      border-radius:var(--radius);
      box-shadow:var(--shadow-sm);
      padding:var(--space-3);
      display:grid;
      gap:12px;
    }
    :root[data-theme="dark"] .calc-card{background:rgba(255,255,255,.04)}
    .calc-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width: 640px){ .calc-grid{grid-template-columns:1fr} }
    .calc-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width: 640px){ .calc-row{grid-template-columns:1fr} }
    .calc-kv{
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
      background:rgba(255,255,255,.55);
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      font-weight:800;
    }
    :root[data-theme="dark"] .calc-kv{background:rgba(255,255,255,.04)}
    .calc-kv span{color:var(--muted);font-weight:700}
    .calc-actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .calc-actions .btn{flex:0 0 auto}
    .calc-hint{color:var(--muted);font-size:.92rem;line-height:1.35}
    .calc-price{
      border:1px solid rgba(16,185,129,.35);
      background:rgba(16,185,129,.08);
      border-radius:14px;
      padding:12px 14px;
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
    }
    :root[data-theme="dark"] .calc-price{background:rgba(16,185,129,.10)}
    .calc-price strong{font-size:1.25rem;letter-spacing:-.2px}
    .calc-map{height:300px;border-radius:14px;border:1px solid var(--border);overflow:hidden}
    .leaflet-container{font:inherit}
    footer{padding:18px 0 26px;color:var(--muted);font-size:.9rem}
    @media (max-width: 980px){
      .hero{grid-template-columns:1fr;gap:14px}
      .grid{grid-template-columns: repeat(2, minmax(0, 1fr))}
      .controls{grid-template-columns:1fr 1fr}
      .price-range{grid-template-columns:1fr 1fr}
    }
    @media (max-width: 640px){
      .actions{gap:8px}
      .btn{padding:10px 10px}
      .controls{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr}
      .gallery{grid-template-columns:1fr 1fr}
    }
    @media (prefers-reduced-motion: reduce){
      *{scroll-behavior:auto;transition:none !important;animation:none !important}
      .skeleton{animation:none !important}
    }
