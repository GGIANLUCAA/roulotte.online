<!DOCTYPE html>
<html lang="it" data-theme="light">
<head>
  <script>
    // Global Error Handler per Debug Critico
    window.onerror = function(msg, url, line, col, error) {
       // Ignora errori di estensioni browser o resize observer benigni
       if (msg.includes('ResizeObserver') || msg.includes('extension')) return;

       const box = document.createElement('div');
       box.id = 'critical-error-box';
       box.style.position = 'fixed';
       box.style.top = '0';
       box.style.left = '0';
       box.style.width = '100%';
       box.style.height = 'auto';
       box.style.maxHeight = '50vh';
       box.style.overflow = 'auto';
       box.style.background = '#dc2626';
       box.style.color = '#fff';
       box.style.padding = '20px';
       box.style.zIndex = '999999';
       box.style.fontSize = '14px';
       box.style.fontFamily = 'monospace';
       box.style.whiteSpace = 'pre-wrap';
       box.style.boxShadow = '0 10px 30px rgba(0,0,0,0.5)';
      box.innerHTML = '<strong>⚠️ ERRORE CRITICO RILEVATO:</strong><br>' + 
                       (msg || 'Errore sconosciuto') + '<br>' + 
                       'Riga: ' + (line || '?') + '<br>' + 
                       'Per favore, invia uno screenshot di questo messaggio.<br><br>' + 
                       (error && error.stack ? error.stack : '');
       
       if (!document.body) {
         window.addEventListener('DOMContentLoaded', () => document.body.appendChild(box));
       } else {
         document.body.appendChild(box);
       }
       return false;
    };
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Roulotte online</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/grapesjs/dist/css/grapes.min.css">
  <link rel="stylesheet" href="admin.css">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="roulotte-store.js"></script>
</head>
<body>
  <a class="skip-link" href="#contenuto">Vai al contenuto</a>
  <div class="toast-wrap" id="toastWrap" aria-live="polite" aria-relevant="additions"></div>

  <div id="loginOverlay" class="login" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="login-card">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="logo" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9L2.2 10.8A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/>
            <circle cx="7" cy="17" r="2"/>
            <circle cx="17" cy="17" r="2"/>
          </svg>
        </div>
        <div>
          <h2 id="loginTitle">Area Admin</h2>
          <p>Accedi con utente <strong>admin</strong> e password <strong>admin</strong></p>
        </div>
      </div>

      <form id="loginForm" style="margin-top:14px">
        <div class="field">
          <label for="user">Username</label>
          <input id="user" name="user" autocomplete="username" required />
        </div>
        <div class="field" style="margin-top:10px">
          <label for="pass">Password</label>
          <input id="pass" name="pass" type="password" autocomplete="current-password" required />
        </div>
        <div class="login-actions">
          <a class="btn" href="index.html">Torna al sito</a>
          <button class="btn btn-primary" type="submit">Entra</button>
        </div>
        <div id="loginError" class="error" hidden>Credenziali non valide.</div>
        <div id="loginDiag" style="margin-top:10px;font-size:0.85rem;color:var(--muted);display:grid;gap:4px">
          <div>API: <span id="loginApiBase">—</span></div>
          <div>WS: <span id="loginWsBase">—</span></div>
          <div>Stato: <span id="loginApiHealth">—</span></div>
          <button class="btn" type="button" id="clearApiOverrideBtn" style="justify-content:center;display:none;margin-top:6px">Ripristina API</button>
        </div>
      </form>
      <form id="recoveryForm" style="margin-top:14px">
        <div class="field">
          <label for="resetCode">Codice reset</label>
          <input id="resetCode" name="resetCode" autocomplete="off" />
        </div>
        <div class="field" style="margin-top:10px">
          <label for="newUser">Nuovo username</label>
          <input id="newUser" name="newUser" autocomplete="username" />
        </div>
        <div class="field" style="margin-top:10px">
          <label for="newPass">Nuova password</label>
          <input id="newPass" name="newPass" type="password" autocomplete="new-password" />
        </div>
        <div class="login-actions">
          <button class="btn" type="button" id="toggleRecoveryBtn">Recupero accesso</button>
          <button class="btn btn-primary" type="submit">Imposta credenziali</button>
        </div>
        <div id="recoveryMsg" class="error ok" hidden></div>
      </form>
    </div>
  </div>

  <div class="app" id="app" aria-hidden="true">
    <aside class="sidebar" aria-label="Menu">
      <a class="brand" href="index.html" aria-label="Vai al sito pubblico">
        <div class="logo" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9L2.2 10.8A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/>
            <circle cx="7" cy="17" r="2"/>
            <circle cx="17" cy="17" r="2"/>
          </svg>
        </div>
        <div>
          <div class="brand-title">Roulotte online</div>
          <div class="brand-sub">Dashboard Admin</div>
          <div style="font-size:0.7rem;color:var(--muted);margin-top:2px">v1.7 (Realtime + Conflitti)</div>
        </div>
      </a>

      <nav aria-label="Sezioni">
        <button class="nav-btn" type="button" data-section="dashboard" aria-current="page">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M7 14v4"/><path d="M12 10v8"/><path d="M17 6v12"/></svg>
          <span class="nav-label">Dashboard</span>
        </button>
        <button class="nav-btn" type="button" data-section="new">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
          <span class="nav-label">Nuova Roulotte</span>
        </button>
        <button class="nav-btn" type="button" data-section="list">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 6h13"/><path d="M8 12h13"/><path d="M8 18h13"/><path d="M3 6h.01"/><path d="M3 12h.01"/><path d="M3 18h.01"/></svg>
          <span class="nav-label">Elenco</span>
        </button>
        <button class="nav-btn" type="button" data-section="categories">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.5 10.5 13.5 3.5a2 2 0 0 0-1.4-.6H5a2 2 0 0 0-2 2v7.1a2 2 0 0 0 .6 1.4l7 7a2 2 0 0 0 2.8 0l7.1-7.1a2 2 0 0 0 0-2.8Z"/><path d="M7.5 7.5h.01"/></svg>
          <span class="nav-label">Categorie</span>
        </button>
        <button class="nav-btn" type="button" data-section="settings">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"/><path d="M19.4 15a7.9 7.9 0 0 0 .1-2l2-1.2-2-3.4-2.3.7a7.4 7.4 0 0 0-1.7-1l-.3-2.4H11l-.3 2.4a7.4 7.4 0 0 0-1.7 1L6.7 8.4l-2 3.4 2 1.2a7.9 7.9 0 0 0 .1 2l-2 1.2 2 3.4 2.3-.7a7.4 7.4 0 0 0 1.7 1l.3 2.4h4.2l.3-2.4a7.4 7.4 0 0 0 1.7-1l2.3.7 2-3.4-2-1.2Z"/></svg>
          <span class="nav-label">Impostazioni</span>
        </button>
        <button class="nav-btn" type="button" data-section="content">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8Z"/><path d="M14 2v6h6"/><path d="M8 13h8"/><path d="M8 17h8"/></svg>
          <span class="nav-label">Contenuti</span>
        </button>
        <button class="nav-btn" type="button" data-section="builder">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5Z"/></svg>
          <span class="nav-label">Editor visivo</span>
        </button>
        <button class="nav-btn" type="button" data-section="media">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z"/><path d="m8 14 2-2 2 2 3-3 3 3"/><path d="M8.5 9.5h.01"/></svg>
          <span class="nav-label">Media</span>
        </button>
      </nav>

      <div class="spacer"></div>

      <div class="system-status" id="systemStatus">
        <div class="status-dot" id="healthDot"></div>
        <span id="healthText">Controllo...</span>
      </div>

      <div class="profile" aria-label="Profilo">
        <div style="display:flex;align-items:center;gap:10px">
          <div class="badge" aria-hidden="true">AD</div>
          <div>
            <div style="font-weight:900">Admin</div>
            <div class="brand-sub">Gestione parco mezzi</div>
          </div>
        </div>
        <button class="btn btn-danger" type="button" id="logoutBtn">Esci</button>
      </div>
    </aside>

    <main class="main" id="contenuto" role="main" aria-label="Contenuto admin">
      <div class="topbar">
        <h1 id="pageTitle">Dashboard</h1>
        <div class="top-actions">
          <a class="btn mobile-only" href="index.html">Sito</a>
          <button class="btn" type="button" id="refreshBtn">Aggiorna</button>
          <button class="btn" type="button" id="themeToggleBtn">Tema: Chiaro</button>
          <button class="btn btn-danger mobile-only" type="button" id="logoutBtnMobile">Esci</button>
        </div>
      </div>

      <section id="dashboard" class="section active" aria-label="Dashboard">
        <details class="help-card" style="margin-bottom:12px">
          <summary>Guida rapida</summary>
          <div class="help-grid">
            <ul>
              <li>Usa “Aggiorna” per ricaricare dati e statistiche.</li>
              <li>Vai su “Elenco” per modificare o duplicare una scheda esistente.</li>
              <li>Vai su “Nuova Roulotte” per creare una scheda e caricare le foto.</li>
            </ul>
            <div class="help-badges">
              <span class="help-badge">Suggerimento: carica foto leggere</span>
              <span class="help-badge">Stato sistema: in alto nel menu</span>
            </div>
          </div>
        </details>
        <div class="grid">
          <div class="card span-4">
            <div class="stat">
              <div>
                <div class="label">In Vendita</div>
                <div class="value" id="statAvailable">0</div>
              </div>
              <div class="status ok">Store</div>
            </div>
          </div>
          <div class="card span-4">
            <div class="stat">
              <div>
                <div class="label">Vendute (Valore)</div>
                <div class="value" id="statSoldValue">â‚¬ 0</div>
                <div class="sub-value" id="statSold">0 veicoli</div>
              </div>
              <div class="status warn">Sold</div>
            </div>
          </div>
          <div class="card span-4">
            <div class="stat">
              <div>
                <div class="label">Valore Magazzino</div>
                <div class="value" id="statValue">â‚¬ 0</div>
                <div class="sub-value" style="font-size:0.9rem;color:var(--muted)">Disponibili</div>
              </div>
              <div class="status ok">â‚¬</div>
            </div>
          </div>
          <div class="card span-12">
            <div class="card-title" style="margin-bottom:12px">Riepilogo Categorie</div>
            <div id="catStats" class="grid" style="grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));gap:10px">
              <!-- Popolato via JS -->
            </div>
          </div>
          <div class="card span-12">
            <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start;flex-wrap:wrap">
              <div>
                <div class="card-title">Suggerimenti</div>
                <div class="hint" style="margin-top:6px">Aggiungi foto leggere (massimo 9) per non saturare la memoria del browser.</div>
              </div>
              <a class="btn btn-primary" href="index.html">Apri sito pubblico</a>
            </div>
          </div>
          <div class="card span-12" style="opacity:0.8">
            <details>
            <summary style="cursor:pointer;font-weight:700;color:var(--muted)">Mostra Log Attività Recenti</summary>
              <div class="log-list" id="activityLog" style="margin-top:10px">
                <!-- Logs popolati via JS -->
              </div>
            </details>
          </div>
        </div>
      </section>

      <section id="builder" class="section" aria-label="Editor visuale" hidden>
        <div class="card">
          <div style="font-weight:900;font-size:1.05rem">Editor visivo (GrapesJS)</div>
          <div class="hint" style="margin-top:6px">Modifica sezioni principali con drag&drop, testi e stili. Salva e pubblica senza toccare il codice.</div>
          <details class="help-card" style="margin-top:12px">
            <summary>Guida rapida</summary>
            <div class="help-grid">
              <ul>
                <li>Seleziona la pagina (Home, Header, Footer…).</li>
                <li>Premi “Carica” per importare i contenuti attuali.</li>
                <li>“Salva bozza” salva senza pubblicare; “Pubblica” rende visibile sul sito.</li>
              </ul>
              <div class="help-badges">
                <span class="help-badge">Bozza ≠ Pubblicato</span>
                <span class="help-badge">Esito azioni: notifiche in basso a destra</span>
              </div>
            </div>
          </details>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
            <div class="field">
              <label>Pagina</label>
              <div style="display:flex;gap:8px;align-items:center">
                <select id="builderPageKey">
                  <option value="home">Home</option>
                  <option value="header">Header</option>
                  <option value="footer">Footer</option>
                  <option value="list_top">Lista (top)</option>
                  <option value="list_bottom">Lista (bottom)</option>
                  <option value="filters">Filtri</option>
                  <option value="detail_dialog">Dialog dettagli</option>
                  <option value="card_template">Template card</option>
                </select>
                <button class="btn" type="button" id="builderLoadBtn">Carica</button>
                <button class="btn" type="button" id="builderSaveBtn">Salva bozza</button>
                <button class="btn btn-primary" type="button" id="builderPublishBtn">Pubblica</button>
              </div>
            </div>
            <div class="field">
              <label>Stato</label>
              <div id="builderStatus" class="hint">Inattivo</div>
            </div>
          </div>
        </div>
        <div class="card">
          <div id="gjs" style="height:70vh;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#fff"></div>
        </div>
      </section>
      <section id="new" class="section" aria-label="Nuova roulotte">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
            <div>
              <div style="font-weight:900;font-size:1.1rem" id="formTitle">Crea nuova scheda</div>
              <div class="hint" style="margin-top:6px">I campi Marca, Modello, Prezzo e Anno sono obbligatori.</div>
            </div>
            <button class="btn" type="button" id="clearFormBtn">Nuova Scheda</button>
          </div>
          <details class="help-card" style="margin-top:12px">
            <summary>Guida rapida</summary>
            <div class="help-grid">
              <ul>
                <li>Compila i campi obbligatori e aggiungi almeno una foto.</li>
                <li>Trascina le foto nell’area: verranno ottimizzate automaticamente.</li>
                <li>Premi “Salva scheda”: vedrai un feedback chiaro di successo o errore.</li>
              </ul>
              <div class="help-badges">
                <span class="help-badge">Copertina: prima foto</span>
                <span class="help-badge">Upload: barra di avanzamento</span>
              </div>
            </div>
          </details>

          <form id="newForm" style="margin-top:14px">
            <input type="hidden" id="editId" name="editId" value="" />
            <div class="form-grid">
              <div class="field">
                <label for="marca">Marca</label>
                <input id="marca" name="marca" autocomplete="organization" required />
              </div>
              <div class="field">
                <label for="modello">Modello</label>
                <input id="modello" name="modello" autocomplete="off" required />
              </div>
              <div class="field">
                <label for="versione">Versione / Allestimento</label>
                <input id="versione" name="versione" autocomplete="off" />
              </div>
              <div class="field">
                <label for="categoryId">Categoria</label>
                <select id="categoryId" name="categoryId">
                  <!-- Popolato via JS -->
                </select>
              </div>
              <div class="field">
                <label for="stato">Stato</label>
                <select id="stato" name="stato">
                  <option value="Ottimo">Ottimo</option>
                  <option value="Buono">Buono</option>
                  <option value="Da sistemare">Da sistemare</option>
                  <option value="Nuovo">Nuovo</option>
                  <option value="Venduto">Venduto</option>
                </select>
              </div>
              <div class="field">
                <label for="stato_annuncio">Pubblicazione</label>
                <select id="stato_annuncio" name="stato_annuncio">
                  <option value="bozza">Bozza</option>
                  <option value="verifica">Verifica</option>
                  <option value="pubblicato">Pubblicato</option>
                  <option value="venduto">Venduto</option>
                </select>
              </div>
              <div class="field">
                <label for="prezzo">Prezzo (€)</label>
                <input id="prezzo" name="prezzo" type="number" inputmode="decimal" min="0" step="0.01" required />
              </div>
              <div class="field">
                <label for="anno">Anno</label>
                <input id="anno" name="anno" type="number" inputmode="numeric" min="1970" max="2100" required />
              </div>
              <div class="field">
                <label for="tipologiaMezzo">Tipologia</label>
                <select id="tipologiaMezzo" name="tipologiaMezzo" required>
                  <option value="">-- Seleziona --</option>
                  <option value="Roulotte stradale">Roulotte stradale</option>
                  <option value="Roulotte da campeggio">Roulotte da campeggio</option>
                  <option value="Casa mobile">Casa mobile</option>
                  <option value="Da sistemare / progetto">Da sistemare / progetto</option>
                </select>
              </div>
              <div class="field">
                <label>Disponibilità</label>
                <div class="choice-box">
                  <label class="choice-item" for="prontaConsegna">
                    <input id="prontaConsegna" name="prontaConsegna" type="checkbox" />
                    Pronta consegna
                  </label>
                </div>
              </div>
              <div class="field">
                <label>Permuta</label>
                <div class="choice-box">
                  <div class="choice-grid" style="grid-template-columns:repeat(2, minmax(0, 1fr))">
                    <label class="choice-item">
                      <input type="radio" name="permuta" value="Sì" />
                      Sì
                    </label>
                    <label class="choice-item">
                      <input type="radio" name="permuta" value="No" />
                      No
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <details style="margin-top:16px">
              <summary style="cursor:pointer;font-weight:900">Stato del mezzo</summary>
              <div class="hint" style="margin-top:6px">Campi facoltativi: aiutano a filtrare e a generare una descrizione più completa.</div>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="condizioneGenerale">Condizione generale</label>
                  <select id="condizioneGenerale" name="condizioneGenerale">
                    <option value="">-- Seleziona --</option>
                    <option value="Nuovo">Nuovo</option>
                    <option value="Usato">Usato</option>
                    <option value="Da sistemare">Da sistemare</option>
                    <option value="Da demolire">Da demolire</option>
                  </select>
                </div>
                <div class="field">
                  <label for="statoInterni">Stato interni</label>
                  <select id="statoInterni" name="statoInterni">
                    <option value="">-- Seleziona --</option>
                    <option value="Ottimo">Ottimo</option>
                    <option value="Buono">Buono</option>
                    <option value="Discreto">Discreto</option>
                    <option value="Da rifare">Da rifare</option>
                  </select>
                </div>
                <div class="field">
                  <label for="statoEsterni">Stato esterni</label>
                  <select id="statoEsterni" name="statoEsterni">
                    <option value="">-- Seleziona --</option>
                    <option value="Ottimo">Ottimo</option>
                    <option value="Buono">Buono</option>
                    <option value="Discreto">Discreto</option>
                    <option value="Da rifare">Da rifare</option>
                  </select>
                </div>
                <div class="field">
                  <label for="infiltrazioni">Presenza infiltrazioni</label>
                  <select id="infiltrazioni" name="infiltrazioni">
                    <option value="">-- Seleziona --</option>
                    <option value="No">No</option>
                    <option value="Sì">Sì</option>
                    <option value="Da verificare">Da verificare</option>
                  </select>
                </div>
                <div class="field">
                  <label for="odori">Odori / muffe</label>
                  <select id="odori" name="odori">
                    <option value="">-- Seleziona --</option>
                    <option value="No">No</option>
                    <option value="Sì">Sì</option>
                  </select>
                </div>
                <div class="field">
                  <label for="provenienza">Provenienza</label>
                  <select id="provenienza" name="provenienza">
                    <option value="">-- Seleziona --</option>
                    <option value="Privato">Privato</option>
                    <option value="Campeggio">Campeggio</option>
                    <option value="Estero">Estero</option>
                  </select>
                </div>
              </div>
            </details>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Omologazione & documenti</summary>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="targata">Targata</label>
                  <select id="targata" name="targata">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="librettoCircolazione">Libretto di circolazione</label>
                  <select id="librettoCircolazione" name="librettoCircolazione">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="omologataCircolazione">Omologata per circolazione</label>
                  <select id="omologataCircolazione" name="omologataCircolazione">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="numeroTelaio">Numero di telaio</label>
                  <input id="numeroTelaio" name="numeroTelaio" autocomplete="off" placeholder="es. VIN / telaio" />
                </div>
                <div class="field">
                  <label for="numeroAssi">Numero assi</label>
                  <select id="numeroAssi" name="numeroAssi">
                    <option value="">-- Seleziona --</option>
                    <option value="Monoasse">Monoasse</option>
                    <option value="Doppio asse">Doppio asse</option>
                  </select>
                </div>
                <div class="field">
                  <label for="timone">Timone</label>
                  <select id="timone" name="timone">
                    <option value="">-- Seleziona --</option>
                    <option value="Presente">Presente</option>
                    <option value="Assente">Assente</option>
                  </select>
                </div>
                <div class="field">
                  <label for="frenoRepulsione">Freno a repulsione</label>
                  <select id="frenoRepulsione" name="frenoRepulsione">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="pesoVuoto">Peso a vuoto (kg)</label>
                  <input id="pesoVuoto" name="pesoVuoto" type="number" inputmode="decimal" min="0" step="1" />
                </div>
              </div>
            </details>

            <div style="margin-top:20px;margin-bottom:10px;font-weight:900;font-size:1.05rem;border-bottom:1px solid var(--border);padding-bottom:5px">Dimensioni & letti</div>
            <div class="form-grid">
              <div class="field">
                 <label for="lunghezza">Lunghezza totale (m)</label>
                 <input id="lunghezza" type="number" step="0.01" placeholder="es. 7.50" />
              </div>
              <div class="field">
                 <label for="lunghezzaInterna">Lunghezza interna (m)</label>
                 <input id="lunghezzaInterna" name="lunghezzaInterna" type="number" step="0.01" placeholder="es. 6.00" />
              </div>
              <div class="field">
                 <label for="larghezza">Larghezza (m)</label>
                 <input id="larghezza" type="number" step="0.01" placeholder="es. 2.30" />
              </div>
              <div class="field">
                 <label for="altezza">Altezza (m)</label>
                 <input id="altezza" name="altezza" type="number" step="0.01" placeholder="es. 2.60" />
              </div>
              <div class="field">
                 <label for="posti">Posti letto totali</label>
                 <input id="posti" type="number" placeholder="es. 4" />
              </div>
              <div class="field">
                 <label for="massa">Massa Complessiva (kg)</label>
                 <input id="massa" type="number" placeholder="es. 1300" />
              </div>
              <div class="field">
                 <label for="documenti">Documenti</label>
                 <select id="documenti">
                   <option value="">-- Seleziona --</option>
                   <option value="Con documenti">Con documenti</option>
                   <option value="Senza documenti">Senza documenti</option>
                   <option value="Con documenti esteri">Con documenti esteri</option>
                 </select>
              </div>
              <div class="field">
                 <label for="tipologia">Tipologia Interna</label>
                 <select id="tipologia">
                   <option value="">-- Seleziona --</option>
                   <option>Bagno con box doccia e wc separati</option>
                   <option>Bagno con box doccia e wc opposti</option>
                   <option>Bagno con box doccia posteriore</option>
                   <option>Bagno con doccia e wc integrati</option>
                   <option>Cucina in linea</option>
                   <option>Cucina ad L oppure ad angolo</option>
                   <option>Cucina in coda</option>
                   <option>Cucina anteriore</option>
                   <option>Dinette a L</option>
                   <option>Dinette a "U" convertibile in letto</option>
                   <option>Dinette tradizionale</option>
                   <option>Semidinette anteriore</option>
                   <option>Dinette anteriore</option>
                   <option>Dinette centrale convertibile in letto (caravan)</option>
                   <option>Dinette a L con divanetto</option>
                   <option>Dinette laterale convertibile in letto (caravan)</option>
                   <option>Dinette couch</option>
                   <option>Dinette per bambini</option>
                   <option>Semidinette anteriore con divano</option>
                 </select>
              </div>
            </div>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Disposizione letti</summary>
              <div class="choice-box" style="margin-top:12px">
                <div class="choice-grid">
                  <label class="choice-item"><input type="checkbox" name="disposizioneLetti" value="Matrimoniale" />Matrimoniale</label>
                  <label class="choice-item"><input type="checkbox" name="disposizioneLetti" value="Singoli" />Singoli</label>
                  <label class="choice-item"><input type="checkbox" name="disposizioneLetti" value="Letti a castello" />Letti a castello</label>
                  <label class="choice-item"><input type="checkbox" name="disposizioneLetti" value="Dinette trasformabile" />Dinette trasformabile</label>
                </div>
              </div>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="lettoFisso">Letto fisso</label>
                  <select id="lettoFisso" name="lettoFisso">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field" style="grid-column: span 2">
                  <label>Ideale per</label>
                  <div class="choice-box">
                    <div class="choice-grid">
                      <label class="choice-item"><input type="checkbox" name="idealePer" value="Coppia" />Coppia</label>
                      <label class="choice-item"><input type="checkbox" name="idealePer" value="Famiglia" />Famiglia</label>
                      <label class="choice-item"><input type="checkbox" name="idealePer" value="Campeggio fisso" />Campeggio fisso</label>
                    </div>
                  </div>
                </div>
              </div>
            </details>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Disposizione interna</summary>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="tipoDinette">Tipo dinette</label>
                  <select id="tipoDinette" name="tipoDinette">
                    <option value="">-- Seleziona --</option>
                    <option value="Piccola">Piccola</option>
                    <option value="Grande">Grande</option>
                    <option value="A U">A U</option>
                    <option value="A L">A L</option>
                  </select>
                </div>
                <div class="field">
                  <label for="cucina">Cucina</label>
                  <select id="cucina" name="cucina">
                    <option value="">-- Seleziona --</option>
                    <option value="Lineare">Lineare</option>
                    <option value="Angolare">Angolare</option>
                  </select>
                </div>
                <div class="field">
                  <label for="bagno">Bagno</label>
                  <select id="bagno" name="bagno">
                    <option value="">-- Seleziona --</option>
                    <option value="Assente">Assente</option>
                    <option value="WC chimico">WC chimico</option>
                    <option value="WC + doccia">WC + doccia</option>
                  </select>
                </div>
                <div class="field">
                  <label for="docciaSeparata">Doccia separata</label>
                  <select id="docciaSeparata" name="docciaSeparata">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="armadi">Armadi</label>
                  <select id="armadi" name="armadi">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="gavoniInterni">Gavoni interni</label>
                  <select id="gavoniInterni" name="gavoniInterni">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
              </div>
            </details>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Impianti & accessori</summary>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="presa220Esterna">Presa 220V esterna</label>
                  <select id="presa220Esterna" name="presa220Esterna">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="impianto12V">Impianto 12V</label>
                  <select id="impianto12V" name="impianto12V">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="batteriaServizi">Batteria servizi</label>
                  <select id="batteriaServizi" name="batteriaServizi">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="illuminazioneLed">Illuminazione LED</label>
                  <select id="illuminazioneLed" name="illuminazioneLed">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="impiantoGas">Impianto gas</label>
                  <select id="impiantoGas" name="impiantoGas">
                    <option value="">-- Seleziona --</option>
                    <option value="A norma">A norma</option>
                    <option value="Da verificare">Da verificare</option>
                  </select>
                </div>
                <div class="field">
                  <label for="numeroBombole">Numero bombole</label>
                  <input id="numeroBombole" name="numeroBombole" type="number" inputmode="numeric" min="0" step="1" />
                </div>
                <div class="field">
                  <label for="scadenzaImpiantoGas">Scadenza impianto gas</label>
                  <input id="scadenzaImpiantoGas" name="scadenzaImpiantoGas" type="date" />
                </div>
                <div class="field">
                  <label for="serbatoioAcquaPulita">Serbatoio acqua pulita</label>
                  <select id="serbatoioAcquaPulita" name="serbatoioAcquaPulita">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="serbatoioAcqueGrigie">Serbatoio acque grigie</label>
                  <select id="serbatoioAcqueGrigie" name="serbatoioAcqueGrigie">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="riscaldamento">Riscaldamento</label>
                  <select id="riscaldamento" name="riscaldamento">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="tipoRiscaldamento">Tipo riscaldamento</label>
                  <select id="tipoRiscaldamento" name="tipoRiscaldamento">
                    <option value="">-- Seleziona --</option>
                    <option value="Truma">Truma</option>
                    <option value="Elettrico">Elettrico</option>
                    <option value="Altro">Altro</option>
                  </select>
                </div>
                <div class="field">
                  <label for="climatizzatore">Climatizzatore</label>
                  <select id="climatizzatore" name="climatizzatore">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="predisposizioneClima">Predisposizione clima</label>
                  <select id="predisposizioneClima" name="predisposizioneClima">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="verandaTendalino">Veranda / tendalino</label>
                  <select id="verandaTendalino" name="verandaTendalino">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="portabici">Portabici</label>
                  <select id="portabici" name="portabici">
                    <option value="">-- Seleziona --</option>
                    <option value="SÃ¬">SÃ¬</option>
                    <option value="No">No</option>
                  </select>
                </div>
              </div>
            </details>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Contatti & media</summary>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="contattoTelefono">Telefono</label>
                  <input id="contattoTelefono" name="contattoTelefono" type="tel" autocomplete="tel" />
                </div>
                <div class="field">
                  <label for="contattoWhatsapp">WhatsApp</label>
                  <input id="contattoWhatsapp" name="contattoWhatsapp" type="tel" autocomplete="tel" />
                </div>
                <div class="field">
                  <label for="contattoEmail">Email</label>
                  <input id="contattoEmail" name="contattoEmail" type="email" autocomplete="email" />
                </div>
                <div class="field">
                  <label for="localita">LocalitÃ </label>
                  <input id="localita" name="localita" autocomplete="address-level2" />
                </div>
                <div class="field">
                  <label for="orariContatto">Orari di contatto</label>
                  <input id="orariContatto" name="orariContatto" autocomplete="off" placeholder="es. 9-12 / 15-19" />
                </div>
                <div class="field">
                  <label for="videoUrl">Video (URL)</label>
                  <input id="videoUrl" name="videoUrl" type="url" autocomplete="off" placeholder="https://..." />
                  <div id="videoPreview" class="hint" style="margin-top:6px"></div>
                </div>
                <div class="field">
                  <label for="planimetriaUrl">Planimetria (URL)</label>
                  <input id="planimetriaUrl" name="planimetriaUrl" type="url" autocomplete="off" placeholder="https://..." />
                </div>
              </div>
            </details>

            <div class="form-grid" style="margin-top:12px">
              <div class="field" style="grid-column:1/-1">
                <label for="note">Note (Descrizione)</label>
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px">
                   <span class="hint">Generata automaticamente dai dati tecnici, ma modificabile.</span>
                   <button type="button" class="btn" style="padding:4px 8px;font-size:0.8rem" onclick="generateDescription()">Rigenera Descrizione</button>
                </div>
                <div style="display:grid">
                  <div class="editor-toolbar">
                    <button type="button" class="editor-btn" onclick="formatDoc('bold')" title="Grassetto">B</button>
                    <button type="button" class="editor-btn" onclick="formatDoc('italic')" title="Corsivo">I</button>
                    <button type="button" class="editor-btn" onclick="formatDoc('underline')" title="Sottolineato">U</button>
                    <div style="width:1px;background:var(--border);margin:0 4px"></div>
                    <button type="button" class="editor-btn" onclick="formatDoc('insertUnorderedList')" title="Elenco puntato">â€¢ Lista</button>
                    <button type="button" class="editor-btn" onclick="formatDoc('insertOrderedList')" title="Elenco numerato">1. Lista</button>
                  </div>
                  <!-- Semplice textarea, ma l'utente chiedeva WYSIWYG. 
                       Per una vera WYSIWYG senza dipendenze, contenteditable Ã¨ meglio.
                       Uso un div contenteditable che sincronizzo con una textarea nascosta. -->
                  <div id="editor" contenteditable="true" style="min-height:120px;padding:12px;border:1px solid var(--border);border-top:none;border-radius:0 0 12px 12px;background:rgba(255,255,255,.05);outline:none"></div>
                  <textarea id="note" name="note" hidden></textarea>
                </div>
              </div>
            </div>

            <div style="margin-top:14px">
              <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
                <div>
                  <div style="font-weight:900">Foto</div>
                  <div class="hint">Trascina qui le immagini o clicca per selezionare.</div>
                </div>
            </div>
            <div class="inline-row" style="margin-top:8px">
              <input id="photoUrlInput" type="url" placeholder="Incolla URL immagine https://..." />
              <button class="btn" type="button" id="addPhotoUrlBtn">Aggiungi URL</button>
              <button class="btn btn-danger" type="button" id="clearPhotosBtn">Svuota foto</button>
            </div>
            <div id="dropzone" class="dropzone" style="margin-top:10px; text-align:center; padding:20px; cursor:pointer">
              <p style="color:var(--muted); pointer-events:none; margin-bottom:10px">Trascina le foto qui o clicca nell'area</p>
              <button type="button" class="btn" style="pointer-events:none">📂 Seleziona File</button>
              <input id="photosInput" name="photosInput" type="file" accept="image/*" multiple style="display:none" />
            </div>
            
            <div id="photosPreview" class="photos" aria-label="Anteprima foto"></div>
            <div id="photoHint" class="hint" style="margin-top:8px"></div>
          </div>

            <div class="row-actions sticky">
              <button class="btn" type="button" id="goListBtn">Vai all'elenco</button>
              <button class="btn btn-primary" type="submit">Salva scheda</button>
            </div>
            <div id="formMsg" class="error" hidden></div>
            <progress id="uploadProg" value="0" max="100" style="width:100%;display:none"></progress>
          </form>
        </div>
      </section>

      <section id="list" class="section" aria-label="Elenco roulotte">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
            <div>
              <div style="font-weight:900;font-size:1.1rem">Elenco</div>
              <div class="hint" id="listMeta" style="margin-top:6px"></div>
            </div>
            <div class="filters" role="search" aria-label="Ricerca elenco">
              <div class="field">
                <label for="listQ">Cerca</label>
                <input id="listQ" name="listQ" type="search" autocomplete="off" placeholder="Marca, modello, anno..." />
              </div>
              <div class="field">
                <label for="listCategory">Categoria</label>
                <select id="listCategory" name="listCategory">
                  <option value="">Tutte</option>
                </select>
              </div>
              <div class="field">
                <label for="listStato">Stato</label>
                <select id="listStato" name="listStato">
                  <option value="">Tutti</option>
                  <option value="Ottimo">Ottimo</option>
                  <option value="Buono">Buono</option>
                  <option value="Da sistemare">Da sistemare</option>
                  <option value="Nuovo">Nuovo</option>
                  <option value="Venduto">Venduto</option>
                </select>
              </div>
              <div class="field">
                <label for="listAnnuncio">Pubblicazione</label>
                <select id="listAnnuncio" name="listAnnuncio">
                  <option value="">Tutte</option>
                  <option value="bozza">Bozza</option>
                  <option value="verifica">Verifica</option>
                  <option value="pubblicato">Pubblicato</option>
                  <option value="venduto">Venduto</option>
                </select>
              </div>
              <div class="field" style="min-width:auto">
                <label class="sr-only" for="listReset">Pulisci filtri</label>
                <button class="btn" type="button" id="listReset">Pulisci filtri</button>
              </div>
            </div>
          </div>

          <div style="margin-top:10px;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:flex-end">
            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end">
              <div class="field" style="min-width:220px">
                <label for="shareTitle">Titolo condivisione</label>
                <input id="shareTitle" type="text" autocomplete="off" placeholder="Es. Selezione per cliente Rossi" />
              </div>
              <div class="field" style="min-width:160px">
                <label for="shareExpires">Scadenza</label>
                <select id="shareExpires">
                  <option value="1">1 giorno</option>
                  <option value="7" selected>7 giorni</option>
                  <option value="30">30 giorni</option>
                </select>
              </div>
              <button class="btn" type="button" id="shareClearSel">Pulisci selezione</button>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end">
              <div class="hint" id="shareSelCount"></div>
              <button class="btn btn-primary" type="button" id="shareCreateBtn">Crea link selezione</button>
            </div>
          </div>

          <div style="margin-top:14px" class="table-wrap" aria-label="Tabella roulotte">
            <table>
              <thead>
                <tr>
                  <th style="width:52px">Sel.</th>
                  <th>Roulotte</th>
                  <th>Anno</th>
                  <th>Prezzo</th>
                  <th>Stato</th>
                  <th>Pubblicazione</th>
                  <th>Azioni</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="detail" class="section" aria-label="Dettaglio mezzo">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
            <div>
              <div style="font-weight:900;font-size:1.1rem" id="detailTitle">Dettaglio</div>
              <div class="hint" id="detailMeta" style="margin-top:6px"></div>
            </div>
            <div class="row-actions" style="justify-content:flex-end">
              <button class="btn" type="button" id="detailBackBtn">Torna all'elenco</button>
              <button class="btn" type="button" id="detailOpenPublicBtn">Apri sul sito</button>
              <button class="btn" type="button" id="detailDuplicateBtn">Duplica</button>
              <button class="btn" type="button" id="detailSoldBtn">Segna venduto</button>
              <button class="btn btn-primary" type="button" id="detailEditBtn">Modifica</button>
            </div>
          </div>

          <div class="grid" style="margin-top:14px">
            <div class="card span-7">
              <div class="card-title" style="margin-bottom:10px">Foto</div>
              <div id="detailPhotos" class="photos" aria-label="Foto mezzo"></div>
            </div>
            <div class="card span-5">
              <div class="card-title" style="margin-bottom:10px">Dettagli</div>
              <div id="detailInfo" style="display:grid;gap:10px"></div>
            </div>
            <div class="card span-12">
              <div class="card-title" style="margin-bottom:10px">Descrizione</div>
              <div id="detailNote" style="color:var(--text)"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="categories" class="section" aria-label="Gestione Categorie">
        <div class="grid">
          <div class="card span-5">
            <div class="card-title" style="margin-bottom:10px">Gestione</div>
            <div class="inline-row" style="margin-bottom:12px">
              <div class="field" style="min-width:240px">
                <label for="newCatName">Nuova categoria</label>
                <input id="newCatName" placeholder="Es. Caravan Nuove" />
              </div>
              <div style="display:flex;justify-content:flex-end">
                <button class="btn btn-primary" type="button" id="addCatBtn">Aggiungi</button>
              </div>
            </div>
            <div id="catList"></div>
          </div>
          <div class="card span-7">
            <div class="card-title" style="margin-bottom:10px">Panoramica</div>
            <div class="hint" style="margin-bottom:12px">Clicca una categoria per aprire l'elenco filtrato.</div>
            <div id="categoriesGrid" class="grid" style="grid-template-columns:repeat(auto-fill, minmax(220px, 1fr));gap:10px"></div>
          </div>
        </div>
      </section>

      <section id="content" class="section" aria-label="Gestione contenuti" hidden>
        <div class="card">
          <div style="display:grid;gap:12px">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
              <div class="field">
                <label for="contentKey">Chiave contenuto</label>
                <div style="display:flex;gap:8px;align-items:center">
                  <input id="contentKey" placeholder="es. home_hero" />
                  <button class="btn" type="button" id="loadContentBtn">Carica</button>
                </div>
              </div>
              <div class="field">
                <label for="contentType">Tipo</label>
                <select id="contentType"><option value="html">HTML</option><option value="markdown">Markdown</option></select>
              </div>
            </div>
            <div class="field">
              <label for="contentData">Contenuto</label>
              <textarea id="contentData" rows="8" placeholder="Testo o HTML"></textarea>
              <div id="quillWrap" style="margin-top:8px;display:none">
                <div id="quillToolbar">
                  <span class="ql-formats">
                    <button class="ql-bold"></button>
                    <button class="ql-italic"></button>
                    <button class="ql-underline"></button>
                  </span>
                  <span class="ql-formats">
                    <button class="ql-list" value="ordered"></button>
                    <button class="ql-list" value="bullet"></button>
                  </span>
                  <span class="ql-formats">
                    <button class="ql-link"></button>
                    <button class="ql-clean"></button>
                  </span>
                </div>
                <div id="quillEditor" style="min-height:160px"></div>
              </div>
            </div>
            <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
              <button class="btn btn-primary" type="button" id="publishContentBtn">Pubblica</button>
              <span id="contentStatus" class="hint">Bozza</span>
            </div>
          </div>
        </div>
        <div class="card">
          <div style="font-weight:900">Anteprima</div>
          <div id="contentPreview" style="margin-top:10px;border:1px solid var(--border);border-radius:12px;padding:12px;min-height:120px;background:rgba(255,255,255,.55)"></div>
        </div>
      </section>

      <section id="media" class="section" aria-label="Media" hidden>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
            <div>
              <div style="font-weight:900;font-size:1.05rem">Libreria Media</div>
              <div class="hint">Carica nuove immagini e gestisci gli asset.</div>
            </div>
            <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
              <input id="mediaInput" type="file" accept="image/*" multiple />
              <button class="btn" type="button" id="mediaRefreshBtn">Aggiorna</button>
            </div>
          </div>
          <progress id="mediaProg" value="0" max="100" style="width:100%;display:none;margin-top:10px"></progress>
        </div>
        <div class="grid" id="mediaGrid"></div>
      </section>
      <section id="settings" class="section" aria-label="Amministrazione">
        <div class="grid">
          <div class="card span-6">
            <div style="font-weight:900;font-size:1.05rem">Sicurezza Admin</div>
            <div class="hint" style="margin-top:6px">Modifica le credenziali di accesso.</div>
            
            <form id="securityForm" style="margin-top:12px">
               <div class="field">
                 <label for="newAuthUser">Nuovo Username</label>
                 <input id="newAuthUser" required />
               </div>
               <div class="field" style="margin-top:8px">
                 <label for="newAuthPass">Nuova Password</label>
                 <input id="newAuthPass" type="password" required />
               </div>
               <div class="row-actions">
                 <button class="btn btn-primary" type="submit">Aggiorna Credenziali</button>
               </div>
               <div id="secMsg" class="error ok" hidden style="background:rgba(16,185,129,.16);border-color:rgba(16,185,129,.35);color:#a7f3d0"></div>
            </form>
          </div>
          <div class="card span-6">
            <div style="font-weight:900;font-size:1.05rem">Esporta Dati</div>
            <div class="hint" style="margin-top:6px">Scarica il database completo in un file.</div>
            <div class="row-actions" style="justify-content:flex-start">
              <button class="btn btn-primary" type="button" id="exportBtn">Esporta</button>
            </div>
          </div>
          <div class="card span-6">
            <div style="font-weight:900;font-size:1.05rem">Importa JSON</div>
            <div class="hint" style="margin-top:6px">Carica un backup per sostituire i dati.</div>
            <div class="row-actions" style="justify-content:flex-start;align-items:center">
              <input id="importInput" type="file" accept="application/json" />
              <button class="btn" type="button" id="importBtn">Importa</button>
            </div>
            <div id="importMsg" class="error" hidden></div>
          </div>
          <div class="card span-6">
            <div style="font-weight:900;font-size:1.05rem">Sync Server</div>
            <div class="hint" style="margin-top:6px">Sincronizza il database con il server locale (dev-server).</div>
            <div class="row-actions" style="justify-content:flex-start;align-items:center;flex-wrap:wrap">
              <button class="btn btn-primary" type="button" id="syncNowBtn">Sincronizza</button>
              <button class="btn" type="button" id="pullServerBtn">Scarica</button>
              <button class="btn" type="button" id="pushServerBtn">Carica</button>
            </div>
            <div id="syncMsg" class="error ok" hidden style="background:rgba(16,185,129,.16);border-color:rgba(16,185,129,.35);color:#a7f3d0"></div>
          </div>
          <div class="card span-12" id="adminUsersCard" hidden>
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
              <div>
                <div style="font-weight:900;font-size:1.05rem">Utenti Admin</div>
                <div class="hint" style="margin-top:6px">Crea e gestisci gli accessi per piÃ¹ persone.</div>
              </div>
              <div class="row-actions" style="justify-content:flex-start;align-items:center;flex-wrap:wrap">
                <button class="btn" type="button" id="adminUsersRefreshBtn">Aggiorna</button>
              </div>
            </div>
            <div id="adminUsersMsg" class="error" hidden style="margin-top:10px"></div>

            <form id="adminUsersCreateForm" style="margin-top:12px">
              <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:10px;align-items:end">
                <div class="field">
                  <label for="adminNewUsername">Username</label>
                  <input id="adminNewUsername" autocomplete="off" required />
                </div>
                <div class="field">
                  <label for="adminNewPassword">Password</label>
                  <input id="adminNewPassword" type="password" autocomplete="new-password" required />
                </div>
                <button class="btn btn-primary" type="submit">Crea utente</button>
              </div>
            </form>

            <div id="adminUsersList" style="margin-top:14px"></div>
          </div>
          <div class="card span-12">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
              <div>
                <div style="font-weight:900;font-size:1.05rem">Pulizia</div>
                <div class="hint" style="margin-top:6px">Elimina tutti i dati salvati nel browser.</div>
              </div>
              <button class="btn btn-danger" type="button" id="wipeBtn">Elimina dati locali</button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="roulotte-store.js"></script>
  <script src="live-reload.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
  <script src="https://unpkg.com/grapesjs"></script>
<script src="admin.js"></script>
</body>
</html>
