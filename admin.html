<!DOCTYPE html>
<html lang="it" data-theme="light">
<head>
  <script>
    window.onerror = function(msg, url, line, col, error) {
      return true;
    };
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Roulotte online</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/grapesjs/dist/css/grapes.min.css">
  <link rel="stylesheet" href="admin.css?v=20260120">
  <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers" crossorigin="anonymous" defer></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="roulotte-store.js"></script>
</head>
<body>
  <a class="skip-link" href="#contenuto">Vai al contenuto</a>
  <div class="toast-wrap" id="toastWrap" aria-live="polite" aria-relevant="additions"></div>

  <div id="loginOverlay" class="login" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="login-card">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="logo" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9L2.2 10.8A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/>
            <circle cx="7" cy="17" r="2"/>
            <circle cx="17" cy="17" r="2"/>
          </svg>
        </div>
        <div>
          <h2 id="loginTitle">Area Admin</h2>
          <p>Accedi con le credenziali admin configurate (oppure usa “Recupero accesso”).</p>
        </div>
      </div>

      <form id="loginForm" style="margin-top:14px">
        <div class="field">
          <label for="user">Username</label>
          <input id="user" name="user" autocomplete="username" required />
        </div>
        <div class="field" style="margin-top:10px">
          <label for="pass">Password</label>
          <input id="pass" name="pass" type="password" autocomplete="current-password" required />
        </div>
        <div class="login-actions">
          <a class="btn" href="index.html">Torna al sito</a>
          <button class="btn btn-primary" type="submit">Entra</button>
        </div>
        <div id="loginError" class="error" hidden>Credenziali non valide.</div>
          <div id="loginDiag" style="margin-top:10px;font-size:0.85rem;color:var(--muted);display:grid;gap:4px">
          <div>API: <span id="loginApiBase">—</span></div>
          <div>WS: <span id="loginWsBase">—</span></div>
          <div>Stato: <span id="loginApiHealth">—</span></div>
          <button class="btn" type="button" id="clearApiOverrideBtn" style="justify-content:center;display:none;margin-top:6px">Ripristina API</button>
          <div class="field" style="margin-top:8px">
            <label for="apiOverrideInput">API personalizzata</label>
            <input id="apiOverrideInput" placeholder="https://dominio:porta" autocomplete="off" />
          </div>
          <div class="login-actions" style="justify-content:flex-start">
            <button class="btn" type="button" id="saveApiOverrideBtn">Salva API</button>
            <button class="btn" type="button" id="unlockOfflineBtn">Sblocca accesso offline</button>
          </div>
        </div>
      </form>
      <form id="recoveryForm" style="margin-top:14px">
        <div class="field">
          <label for="resetCode">Codice reset</label>
          <input id="resetCode" name="resetCode" autocomplete="off" />
        </div>
        <div class="field" style="margin-top:10px">
          <label for="newUser">Nuovo username</label>
          <input id="newUser" name="newUser" autocomplete="username" />
        </div>
        <div class="field" style="margin-top:10px">
          <label for="newPass">Nuova password</label>
          <input id="newPass" name="newPass" type="password" autocomplete="new-password" />
        </div>
        <div class="login-actions">
          <button class="btn" type="button" id="toggleRecoveryBtn">Recupero accesso</button>
          <button class="btn btn-primary" type="submit">Imposta credenziali</button>
        </div>
        <div id="recoveryMsg" class="error ok" hidden></div>
      </form>
    </div>
  </div>

  <div class="app" id="app" aria-hidden="true">
    <aside class="sidebar" aria-label="Menu">
      <a class="brand" href="index.html" aria-label="Vai al sito pubblico">
        <div class="logo" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9L2.2 10.8A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/>
            <circle cx="7" cy="17" r="2"/>
            <circle cx="17" cy="17" r="2"/>
          </svg>
        </div>
        <div>
          <div class="brand-title">Roulotte online</div>
        </div>
      </a>

      <nav aria-label="Sezioni">
        <button class="nav-btn" type="button" data-section="dashboard" aria-current="page">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M7 14v4"/><path d="M12 10v8"/><path d="M17 6v12"/></svg>
          <span class="nav-label">Dashboard</span>
        </button>
        <button class="nav-btn" type="button" data-section="new">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
          <span class="nav-label">Nuova Roulotte</span>
        </button>
        <button class="nav-btn" type="button" data-section="list">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 6h13"/><path d="M8 12h13"/><path d="M8 18h13"/><path d="M3 6h.01"/><path d="M3 12h.01"/><path d="M3 18h.01"/></svg>
          <span class="nav-label">Elenco</span>
        </button>
        <button class="nav-btn" type="button" data-section="categories">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.5 10.5 13.5 3.5a2 2 0 0 0-1.4-.6H5a2 2 0 0 0-2 2v7.1a2 2 0 0 0 .6 1.4l7 7a2 2 0 0 0 2.8 0l7.1-7.1a2 2 0 0 0 0-2.8Z"/><path d="M7.5 7.5h.01"/></svg>
          <span class="nav-label">Categorie</span>
        </button>
        <button class="nav-btn" type="button" data-section="settings">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"/><path d="M19.4 15a7.9 7.9 0 0 0 .1-2l2-1.2-2-3.4-2.3.7a7.4 7.4 0 0 0-1.7-1l-.3-2.4H11l-.3 2.4a7.4 7.4 0 0 0-1.7 1L6.7 8.4l-2 3.4 2 1.2a7.9 7.9 0 0 0 .1 2l-2 1.2 2 3.4 2.3-.7a 7.4 7.4 0 0 0 1.7 1l.3 2.4h4.2l.3-2.4a7.4 7.4 0 0 0 1.7-1l2.3.7 2-3.4-2-1.2Z"/></svg>
          <span class="nav-label">Impostazioni</span>
        </button>
        <button class="nav-btn" type="button" data-section="content">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
          <span class="nav-label">Contenuti</span>
        </button>
        <button class="nav-btn" type="button" data-section="media">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 5h18v14H3z"/><path d="M10 14l-3 3"/><path d="M14 11l-7 7"/><circle cx="17" cy="8" r="2"/></svg>
          <span class="nav-label">Media</span>
        </button>
        <button class="nav-btn" type="button" data-section="live">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 4h18v12H3z"/><path d="M8 20h8"/><path d="M12 16v4"/></svg>
          <span class="nav-label">Editor Live</span>
        </button>
        <button class="nav-btn" type="button" data-section="help">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Z"/><path d="M9.1 9a3 3 0 0 1 5.8 1 3 3 0 0 1-1.8 2.6l-.7.3v1.2"/><path d="M12 17h.01"/></svg>
          <span class="nav-label">Guida</span>
        </button>
      </nav>

      <div class="spacer"></div>

      <div class="system-status" id="systemStatus">
        <div class="status-dot" id="healthDot"></div>
        <span id="healthText">Controllo...</span>
      </div>

      <div class="profile" aria-label="Profilo">
        <div style="display:flex;align-items:center;gap:10px">
          <div class="badge" aria-hidden="true">AD</div>
          <div>
            <div style="font-weight:900">Admin</div>
            <div class="brand-sub">Gestione parco mezzi</div>
          </div>
        </div>
        <button class="btn btn-danger" type="button" id="logoutBtn">Esci</button>
      </div>
    </aside>

    <main class="main" id="contenuto" role="main" aria-label="Contenuto admin">
      <div class="topbar">
        <h1 id="pageTitle">Dashboard</h1>
        <div class="top-actions">
          <a class="btn mobile-only" href="index.html">Sito</a>
          <button class="btn" type="button" id="openSiteBtn">Apri Sito</button>
          <button class="btn" type="button" id="refreshBtn">Aggiorna</button>
          <button class="btn" type="button" id="themeToggleBtn">Tema: Chiaro</button>
          <button class="btn" type="button" id="voiceToggleBtn" aria-pressed="false">Voce: Off</button>
          <button class="btn" type="button" id="helpTopBtn">Guida</button>
          <div id="modeBadge" class="hint">Modalità: —</div>
          <button class="btn" type="button" id="deployNowBtn">Aggiorna Online</button>
          <button class="btn btn-danger mobile-only" type="button" id="logoutBtnMobile">Esci</button>
        </div>
      </div>

      <section id="dashboard" class="section active" aria-label="Dashboard">
        <details class="help-card" style="margin-bottom:12px">
          <summary>Guida rapida</summary>
          <div class="help-grid">
            <ul>
              <li>Usa “Aggiorna” per ricaricare dati e statistiche.</li>
              <li>Vai su “Elenco” per modificare o duplicare una scheda esistente.</li>
              <li>Vai su “Nuova Roulotte” per creare una scheda e caricare le foto.</li>
            </ul>
            <div class="help-badges">
              <span class="help-badge">Suggerimento: carica foto leggere</span>
              <span class="help-badge">Stato sistema: in alto nel menu</span>
            </div>
          </div>
        </details>
        <div class="row-actions" style="gap:8px;flex-wrap:wrap;margin-bottom:12px">
          <label class="choice-item" style="margin-right:6px">
            <input id="autoRefreshToggle" type="checkbox" />
            Auto Aggiorna
          </label>
          <select id="autoRefreshInterval" class="btn" style="padding:4px 8px;font-size:0.8rem">
            <option value="30">30s</option>
            <option value="60" selected>60s</option>
            <option value="120">120s</option>
          </select>
          <button class="btn" type="button" id="probeBtn">Prova connessione</button>
          <button class="btn" type="button" id="syncNowBtnDash">Sync ora</button>
          <button class="btn" type="button" id="filterNoPhotosBtn">Senza foto</button>
          <button class="btn" type="button" id="filterDraftsBtn">Bozze</button>
          <button class="btn" type="button" id="filterPublishedBtn">Pubblicati</button>
          <div class="hint" id="wsStatus" style="margin-left:auto">WS: —</div>
        </div>
        <div class="grid">
          <div class="card span-4">
            <div class="stat">
              <div>
                <div class="label">In Vendita</div>
                <div class="value" id="statAvailable">0</div>
              </div>
              <div class="status ok">Store</div>
            </div>
          </div>
          <div class="card span-4">
            <div class="stat">
              <div>
                <div class="label">Vendute (Valore)</div>
                <div class="value" id="statSoldValue">€ 0</div>
                <div class="sub-value" id="statSold">0 veicoli</div>
              </div>
              <div class="status warn">Sold</div>
            </div>
          </div>
          <div class="card span-4">
            <div class="stat">
              <div>
                <div class="label">Valore Magazzino</div>
                <div class="value" id="statValue">€ 0</div>
                <div class="sub-value" style="font-size:0.9rem;color:var(--muted)">Disponibili</div>
              </div>
              <div class="status ok">€</div>
            </div>
          </div>
          <div class="card span-4">
            <div class="stat">
              <div>
                <div class="label">Prezzo medio</div>
                <div class="value" id="statAvgPrice">€ 0</div>
                <div class="sub-value" id="statMinMax">min € — · max € —</div>
              </div>
              <div class="status ok">Σ</div>
            </div>
          </div>
          <div class="card span-4">
            <div class="stat">
              <div>
                <div class="label">Pubblicazione</div>
                <div class="value" id="statPublished">0</div>
                <div class="sub-value" id="statDrafts">bozze: 0</div>
              </div>
              <div class="status ok">Annunci</div>
            </div>
          </div>
          <div class="card span-4">
            <div class="stat">
              <div>
                <div class="label">Foto mancanti</div>
                <div class="value" id="statNoPhotos">0</div>
                <div class="sub-value" style="font-size:0.9rem;color:var(--muted)">schede senza immagini</div>
              </div>
              <div class="status warn">Foto</div>
            </div>
          </div>
          <div class="card span-12">
            <div class="card-title" style="margin-bottom:8px">Distribuzione Prezzi per Categoria</div>
            <div id="chartPriceByCat" style="display:grid;gap:8px"></div>
          </div>
          <div class="card span-12">
            <div class="card-title" style="margin-bottom:8px">Istogramma Anni (Disponibili)</div>
            <div id="chartYearHistogram" style="display:grid;gap:8px"></div>
          </div>
          <div class="card span-12">
            <div class="card-title" style="margin-bottom:8px">Distribuzione Prezzi per Fasce</div>
            <div id="chartPriceBands" style="display:grid;gap:8px"></div>
          </div>
          <div class="card span-12">
            <div class="card-title" style="margin-bottom:8px">Schede da sistemare (Top 5)</div>
            <div id="qualityIssuesList" style="display:grid;gap:8px"></div>
          </div>
          <div class="card span-12">
            <div class="card-title" style="margin-bottom:12px">Riepilogo Categorie</div>
            <div id="catStats" class="grid" style="grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));gap:10px">
              <!-- Popolato via JS -->
            </div>
          </div>
          <div class="card span-12">
            <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start;flex-wrap:wrap">
              <div>
                <div class="card-title">Suggerimenti</div>
                <div class="hint" style="margin-top:6px">Aggiungi foto leggere (massimo 9) per non saturare la memoria del browser.</div>
              </div>
              <a class="btn btn-primary" href="index.html">Apri sito pubblico</a>
            </div>
          </div>
          <div class="card span-12" id="assistantCard">
            <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start;flex-wrap:wrap">
              <div>
                <div class="card-title">Assistente rapido</div>
                <div class="hint" style="margin-top:6px">Esempi: “duplica ABC123”, “venduto ABC123”, “crea link”, “rigenera descrizione”, “vai elenco”.</div>
              </div>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px">
              <input id="assistantInput" name="assistantInput" type="search" autocomplete="off" placeholder="Scrivi un comando..." style="flex:1;min-width:220px" />
              <button class="btn btn-primary" type="button" id="assistantRunBtn">Esegui</button>
            </div>
            <div id="assistantChips" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:10px"></div>
            <div id="assistantResult" class="hint" style="margin-top:8px"></div>
          </div>
          <div class="card span-12" style="opacity:0.8">
            <details>
              <summary style="cursor:pointer;font-weight:700;color:var(--muted)">Mostra Log Attività Recenti</summary>
              <div class="log-list" id="activityLog" style="margin-top:10px">
                <!-- Logs popolati via JS -->
              </div>
            </details>
          </div>
        </div>
      </section>

      <section id="content" class="section" aria-label="Contenuti" hidden>
        <div class="row-actions" style="justify-content:flex-end"><button class="btn" type="button" data-help-target="help-content">Guida</button></div>
        <div class="grid">
          <div class="card span-12">
            <div style="font-weight:900;font-size:1.05rem">Contenuti</div>
            <div class="hint" style="margin-top:6px">Modifica chiavi HTML/Markdown e pubblica senza toccare il codice.</div>
            <div class="grid" style="margin-top:12px">
              <div class="field span-6">
                <label for="contentKey">Chiave</label>
                <input id="contentKey" list="contentKeys" autocomplete="off" placeholder="Es. page_footer_fragment" />
                <datalist id="contentKeys">
                  <option value="page_footer_fragment"></option>
                  <option value="page_footer_styles"></option>
                </datalist>
              </div>
              <div class="field span-3">
                <label for="contentType">Tipo</label>
                <select id="contentType">
                  <option value="html">HTML</option>
                  <option value="markdown">Markdown</option>
                  <option value="text">Testo</option>
                </select>
              </div>
              <div class="field span-3">
                <label>Azioni</label>
                <div style="display:flex;gap:8px;flex-wrap:wrap">
                  <button class="btn" type="button" id="loadContentBtn">Carica</button>
                  <button class="btn btn-primary" type="button" id="publishContentBtn">Pubblica</button>
                </div>
              </div>
              <div class="field span-12">
                <label for="contentData">Contenuto</label>
                <textarea id="contentData" rows="14" style="resize:vertical"></textarea>
                <div id="contentStatus" class="hint" style="margin-top:8px">Inattivo</div>
              </div>
              <div class="field span-12">
                <label>Anteprima</label>
                <div id="contentPreview" class="card" style="padding:12px;min-height:60px"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="live" class="section" aria-label="Editor Live" hidden>
        <div class="row-actions" style="justify-content:flex-end"><button class="btn" type="button" data-help-target="help-live">Guida</button></div>
        <div class="card">
          <div style="font-weight:900;font-size:1.05rem">Editor Live</div>
          <div class="hint" style="margin-top:6px">Modifica direttamente il sito come lo vedi. Attiva modifica, cambia testi e salva/pubblichi.</div>
          <div class="row-actions" style="margin-top:10px;gap:8px;flex-wrap:wrap">
            <button class="btn" type="button" id="liveEnableBtn">Attiva modifica</button>
            <button class="btn" type="button" id="liveReloadBtn">Ricarica</button>
            <button class="btn" type="button" id="liveSaveBtn" disabled>Salva bozza</button>
            <button class="btn btn-primary" type="button" id="livePublishBtn" disabled>Pubblica</button>
            <div id="liveStatus" class="hint" style="margin-left:auto">Inattivo</div>
          </div>
        </div>
        <div class="card">
          <div class="live-grid">
            <div class="live-wrap">
              <iframe id="liveFrame" title="Editor Live" loading="lazy"></iframe>
            </div>
            <aside class="live-panel" aria-label="Proprietà selezione">
              <div class="card-title" style="margin-bottom:8px">Proprietà</div>
              <div class="field">
                <label>Chiave</label>
                <input id="liveKeyLabel" readonly />
              </div>
              <div class="field">
                <label>Testo</label>
                <textarea id="livePropText" rows="4" placeholder="Modifica il testo selezionato"></textarea>
              </div>
              <div class="field">
                <label>Link href</label>
                <input id="livePropHref" placeholder="https://…" />
              </div>
              <div class="field">
                <label>Immagine src</label>
                <input id="livePropSrc" placeholder="/path/immagine.jpg" />
              </div>
              <div class="field">
                <label>Immagine alt</label>
                <input id="livePropAlt" placeholder="Testo alternativo" />
              </div>
              <div class="row-actions" style="justify-content:flex-start">
                <button class="btn" type="button" id="liveApplyBtn" disabled>Applica</button>
                <div id="livePanelStatus" class="hint" style="margin-left:auto">Nessuna selezione</div>
              </div>
              <div class="card-actions" style="margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:8px">
                <button class="btn" type="button" id="liveMoveUpBtn" disabled>Sposta su</button>
                <button class="btn" type="button" id="liveMoveDownBtn" disabled>Sposta giù</button>
                <button class="btn btn-danger" type="button" id="liveDeleteBtn" disabled>Elimina</button>
                <div style="display:flex;gap:8px;align-items:end">
                  <div class="field" style="flex:1 1 auto">
                    <label>Aggiungi blocco</label>
                    <select id="liveAddBlockSelect">
                      <option value="paragraph">Paragrafo</option>
                      <option value="cta">CTA</option>
                      <option value="image">Immagine</option>
                      <option value="divider">Divisore</option>
                    </select>
                  </div>
                  <button class="btn btn-primary" type="button" id="liveAddBlockBtn">Aggiungi</button>
                </div>
              </div>
            </aside>
          </div>
        </div>
      </section>
      <section id="media" class="section" aria-label="Archivio media" hidden>
        <div class="row-actions" style="justify-content:flex-end"><button class="btn" type="button" data-help-target="help-media">Guida</button></div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
            <div>
              <div class="card-title">Archivio media</div>
              <div class="hint" style="margin-top:6px">Carica immagini generali e assegnale ai modelli. Evita duplicati: il sistema riusa gli upload esistenti.</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="mediaUploadInput" type="file" accept="image/*" multiple style="display:none" />
              <button class="btn btn-primary" type="button" id="mediaUploadBtn">Carica immagini</button>
              <input id="mediaSearch" placeholder="Cerca…" style="min-width:220px" />
            </div>
          </div>
        </div>
        <div class="card">
          <div id="mediaGrid" class="media-grid"></div>
        </div>
      </section>
      <section id="new" class="section" aria-label="Nuova roulotte">
        <div class="row-actions" style="justify-content:flex-end"><button class="btn" type="button" data-help-target="help-new">Guida</button></div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
            <div>
              <div style="font-weight:900;font-size:1.1rem" id="formTitle">Crea nuova scheda</div>
              <div class="hint" style="margin-top:6px">I campi Marca, Modello, Prezzo e Anno sono obbligatori.</div>
            </div>
            <button class="btn" type="button" id="clearFormBtn">Nuova Scheda</button>
          </div>
          <details class="help-card" style="margin-top:12px">
            <summary>Guida rapida</summary>
            <div class="help-grid">
              <ul>
                <li>Compila i campi obbligatori e aggiungi almeno una foto.</li>
                <li>Trascina le foto nell’area: verranno ottimizzate automaticamente.</li>
                <li>Premi “Salva scheda”: vedrai un feedback chiaro di successo o errore.</li>
              </ul>
              <div class="help-badges">
                <span class="help-badge">Copertina: prima foto</span>
                <span class="help-badge">Upload: barra di avanzamento</span>
              </div>
            </div>
          </details>

          <details class="help-card" style="margin-top:12px" open>
            <summary>Assistente AI (gratis)</summary>
            <div class="help-grid">
              <div>
                <div class="hint">Incolla un testo (da WhatsApp, Subito, email). L’assistente prova a compilare e suggerire i campi.</div>
                <div class="field" style="margin-top:10px">
                  <label for="aiInput">Testo annuncio</label>
                  <textarea id="aiInput" rows="5" placeholder="Esempio: Hobby 460 2016 - Ottimo stato - 12.900€ - Targata sì - Infiltrazioni no - Tel 3331234567"></textarea>
                </div>
                <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
                  <button class="btn" type="button" id="aiAnalyzeBtn">Analizza testo</button>
                  <button class="btn btn-primary" type="button" id="aiApplyBtn" disabled>Applica suggerimenti</button>
                  <button class="btn btn-danger" type="button" id="aiClearBtn">Pulisci</button>
                  <button class="btn" type="button" id="copyLastBtn">Copia da ultima scheda</button>
                </div>
              </div>
              <div>
                <div style="font-weight:900">Suggerimenti</div>
                <div id="aiSuggestions" class="hint" style="margin-top:8px">Nessuna analisi eseguita.</div>
              </div>
            </div>
          </details>

          <details class="help-card" style="margin-top:12px">
            <summary>Preset & blocchi</summary>
            <div class="help-grid">
              <div>
                <div class="hint">Salva valori di default e, se vuoi, blocca alcuni campi per non modificarli per errore.</div>
                <div class="choice-box" style="margin-top:10px">
                  <label class="choice-item" for="defaultsLockEnabled">
                    <input id="defaultsLockEnabled" type="checkbox" />
                    Blocca campi con default
                  </label>
                  <label class="choice-item" for="defaultsLockOnEdit">
                    <input id="defaultsLockOnEdit" type="checkbox" />
                    Blocca anche in modifica
                  </label>
                </div>
                <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
                  <button class="btn btn-primary" type="button" id="defaultsSaveBtn">Salva valori attuali</button>
                  <button class="btn" type="button" id="defaultsApplyBtn">Applica default</button>
                  <button class="btn btn-danger" type="button" id="defaultsResetBtn">Reset default</button>
                </div>
              </div>
              <div>
                <div style="font-weight:900">Stato</div>
                <div id="defaultsStatus" class="hint" style="margin-top:8px">Nessun default salvato.</div>
              </div>
            </div>
          </details>

          <form id="newForm" class="new-form" style="margin-top:14px">
            <input type="hidden" id="editId" name="editId" value="" />
            <div class="new-form-layout">
              <div class="new-form-main">
                <div class="form-grid">
              <div class="field">
                <label for="marca">Marca</label>
                <input id="marca" name="marca" autocomplete="organization" required />
              </div>
              <div class="field">
                <label for="modello">Modello</label>
                <input id="modello" name="modello" autocomplete="off" required />
              </div>
              <div class="field">
                <label for="versione">Versione / Allestimento</label>
                <input id="versione" name="versione" autocomplete="off" />
              </div>
              <div class="field">
                <label for="categoryId">Categoria</label>
                <select id="categoryId" name="categoryId">
                  <!-- Popolato via JS -->
                </select>
              </div>
              <div class="field">
                <label for="stato">Stato</label>
                <select id="stato" name="stato">
                  <option value="Ottimo">Ottimo</option>
                  <option value="Buono">Buono</option>
                  <option value="Da sistemare">Da sistemare</option>
                  <option value="Nuovo">Nuovo</option>
                  <option value="Venduto">Venduto</option>
                </select>
              </div>
              <div class="field">
                <label for="stato_annuncio">Pubblicazione</label>
                <select id="stato_annuncio" name="stato_annuncio">
                  <option value="bozza">Bozza</option>
                  <option value="verifica">Verifica</option>
                  <option value="pubblicato">Pubblicato</option>
                  <option value="venduto">Venduto</option>
                </select>
              </div>
              <div class="field">
                <label for="prezzo">Prezzo (€)</label>
                <input id="prezzo" name="prezzo" type="number" inputmode="decimal" min="0" step="0.01" required />
              </div>
              <div class="field">
                <label for="anno">Anno</label>
                <input id="anno" name="anno" type="number" inputmode="numeric" min="1970" max="2100" required />
              </div>
              <div class="field">
                <label for="tipologiaMezzo">Tipologia</label>
                <select id="tipologiaMezzo" name="tipologiaMezzo" required>
                  <option value="">-- Seleziona --</option>
                  <option value="Roulotte stradale">Roulotte stradale</option>
                  <option value="Roulotte da campeggio">Roulotte da campeggio</option>
                  <option value="Casa mobile">Casa mobile</option>
                  <option value="Da sistemare / progetto">Da sistemare / progetto</option>
                </select>
              </div>
              <div class="field">
                <label>Disponibilità</label>
                <div class="choice-box">
                  <label class="choice-item" for="prontaConsegna">
                    <input id="prontaConsegna" name="prontaConsegna" type="checkbox" />
                    Pronta consegna
                  </label>
                </div>
              </div>
              <div class="field">
                <label>Permuta</label>
                <div class="choice-box">
                  <div class="choice-grid" style="grid-template-columns:repeat(2, minmax(0, 1fr))">
                    <label class="choice-item">
                      <input type="radio" name="permuta" value="Sì" />
                      Sì
                    </label>
                    <label class="choice-item">
                      <input type="radio" name="permuta" value="No" />
                      No
                    </label>
                  </div>
                </div>
              </div>
            </div>
              </div>

            <details style="margin-top:16px">
              <summary style="cursor:pointer;font-weight:900">Stato del mezzo</summary>
              <div class="hint" style="margin-top:6px">Campi facoltativi: aiutano a filtrare e a generare una descrizione più completa.</div>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="condizioneGenerale">Condizione generale</label>
                  <select id="condizioneGenerale" name="condizioneGenerale">
                    <option value="">-- Seleziona --</option>
                    <option value="Nuovo">Nuovo</option>
                    <option value="Usato">Usato</option>
                    <option value="Da sistemare">Da sistemare</option>
                    <option value="Da demolire">Da demolire</option>
                  </select>
                </div>
                <div class="field">
                  <label for="statoInterni">Stato interni</label>
                  <select id="statoInterni" name="statoInterni">
                    <option value="">-- Seleziona --</option>
                    <option value="Ottimo">Ottimo</option>
                    <option value="Buono">Buono</option>
                    <option value="Discreto">Discreto</option>
                    <option value="Da rifare">Da rifare</option>
                  </select>
                </div>
                <div class="field">
                  <label for="statoEsterni">Stato esterni</label>
                  <select id="statoEsterni" name="statoEsterni">
                    <option value="">-- Seleziona --</option>
                    <option value="Ottimo">Ottimo</option>
                    <option value="Buono">Buono</option>
                    <option value="Discreto">Discreto</option>
                    <option value="Da rifare">Da rifare</option>
                  </select>
                </div>
                <div class="field">
                  <label for="infiltrazioni">Presenza infiltrazioni</label>
                  <select id="infiltrazioni" name="infiltrazioni">
                    <option value="">-- Seleziona --</option>
                    <option value="No">No</option>
                    <option value="Sì">Sì</option>
                    <option value="Da verificare">Da verificare</option>
                  </select>
                </div>
                <div class="field">
                  <label for="odori">Odori / muffe</label>
                  <select id="odori" name="odori">
                    <option value="">-- Seleziona --</option>
                    <option value="No">No</option>
                    <option value="Sì">Sì</option>
                  </select>
                </div>
                <div class="field">
                  <label for="provenienza">Provenienza</label>
                  <select id="provenienza" name="provenienza">
                    <option value="">-- Seleziona --</option>
                    <option value="Privato">Privato</option>
                    <option value="Campeggio">Campeggio</option>
                    <option value="Estero">Estero</option>
                  </select>
                </div>
              </div>
            </details>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Omologazione & documenti</summary>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="targata">Targata</label>
                  <select id="targata" name="targata">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="librettoCircolazione">Libretto di circolazione</label>
                  <select id="librettoCircolazione" name="librettoCircolazione">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="omologataCircolazione">Omologata per circolazione</label>
                  <select id="omologataCircolazione" name="omologataCircolazione">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="numeroTelaio">Numero di telaio</label>
                  <input id="numeroTelaio" name="numeroTelaio" autocomplete="off" placeholder="es. VIN / telaio" />
                </div>
                <div class="field">
                  <label for="numeroAssi">Numero assi</label>
                  <select id="numeroAssi" name="numeroAssi">
                    <option value="">-- Seleziona --</option>
                    <option value="Monoasse">Monoasse</option>
                    <option value="Doppio asse">Doppio asse</option>
                  </select>
                </div>
                <div class="field">
                  <label for="timone">Timone</label>
                  <select id="timone" name="timone">
                    <option value="">-- Seleziona --</option>
                    <option value="Presente">Presente</option>
                    <option value="Assente">Assente</option>
                  </select>
                </div>
                <div class="field">
                  <label for="frenoRepulsione">Freno a repulsione</label>
                  <select id="frenoRepulsione" name="frenoRepulsione">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="pesoVuoto">Peso a vuoto (kg)</label>
                  <input id="pesoVuoto" name="pesoVuoto" type="number" inputmode="decimal" min="0" step="1" />
                </div>
              </div>
            </details>

            <div style="margin-top:20px;margin-bottom:10px;font-weight:900;font-size:1.05rem;border-bottom:1px solid var(--border);padding-bottom:5px">Dimensioni & letti</div>
            <div class="form-grid">
              <div class="field">
                 <label for="lunghezza">Lunghezza totale (m)</label>
                 <input id="lunghezza" type="number" step="0.01" placeholder="es. 7.50" />
              </div>
              <div class="field">
                 <label for="lunghezzaInterna">Lunghezza interna (m)</label>
                 <input id="lunghezzaInterna" name="lunghezzaInterna" type="number" step="0.01" placeholder="es. 6.00" />
              </div>
              <div class="field">
                 <label for="larghezza">Larghezza (m)</label>
                 <input id="larghezza" type="number" step="0.01" placeholder="es. 2.30" />
              </div>
              <div class="field">
                 <label for="altezza">Altezza (m)</label>
                 <input id="altezza" name="altezza" type="number" step="0.01" placeholder="es. 2.60" />
              </div>
              <div class="field">
                 <label for="posti">Posti letto totali</label>
                 <input id="posti" type="number" placeholder="es. 4" />
              </div>
              <div class="field">
                 <label for="massa">Massa Complessiva (kg)</label>
                 <input id="massa" type="number" placeholder="es. 1300" />
              </div>
              <div class="field">
                 <label for="documenti">Documenti</label>
                 <select id="documenti">
                   <option value="">-- Seleziona --</option>
                   <option value="Con documenti">Con documenti</option>
                   <option value="Senza documenti">Senza documenti</option>
                   <option value="Con documenti esteri">Con documenti esteri</option>
                 </select>
              </div>
              <div class="field">
                 <label for="tipologia">Tipologia Interna</label>
                 <select id="tipologia">
                   <option value="">-- Seleziona --</option>
                   <option>Bagno con box doccia e wc separati</option>
                   <option>Bagno con box doccia e wc opposti</option>
                   <option>Bagno con box doccia posteriore</option>
                   <option>Bagno con doccia e wc integrati</option>
                   <option>Cucina in linea</option>
                   <option>Cucina ad L oppure ad angolo</option>
                   <option>Cucina in coda</option>
                   <option>Cucina anteriore</option>
                   <option>Dinette a L</option>
                   <option>Dinette a "U" convertibile in letto</option>
                   <option>Dinette tradizionale</option>
                   <option>Semidinette anteriore</option>
                   <option>Dinette anteriore</option>
                   <option>Dinette centrale convertibile in letto (caravan)</option>
                   <option>Dinette a L con divanetto</option>
                   <option>Dinette laterale convertibile in letto (caravan)</option>
                   <option>Dinette couch</option>
                   <option>Dinette per bambini</option>
                   <option>Semidinette anteriore con divano</option>
                 </select>
              </div>
            </div>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Disposizione letti</summary>
              <div class="choice-box" style="margin-top:12px">
                <div class="choice-grid">
                  <label class="choice-item"><input type="checkbox" name="disposizioneLetti" value="Matrimoniale" />Matrimoniale</label>
                  <label class="choice-item"><input type="checkbox" name="disposizioneLetti" value="Singoli" />Singoli</label>
                  <label class="choice-item"><input type="checkbox" name="disposizioneLetti" value="Letti a castello" />Letti a castello</label>
                  <label class="choice-item"><input type="checkbox" name="disposizioneLetti" value="Dinette trasformabile" />Dinette trasformabile</label>
                </div>
              </div>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="lettoFisso">Letto fisso</label>
                  <select id="lettoFisso" name="lettoFisso">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field" style="grid-column: span 2">
                  <label>Ideale per</label>
                  <div class="choice-box">
                    <div class="choice-grid">
                      <label class="choice-item"><input type="checkbox" name="idealePer" value="Coppia" />Coppia</label>
                      <label class="choice-item"><input type="checkbox" name="idealePer" value="Famiglia" />Famiglia</label>
                      <label class="choice-item"><input type="checkbox" name="idealePer" value="Campeggio fisso" />Campeggio fisso</label>
                    </div>
                  </div>
                </div>
              </div>
            </details>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Disposizione interna</summary>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="tipoDinette">Tipo dinette</label>
                  <select id="tipoDinette" name="tipoDinette">
                    <option value="">-- Seleziona --</option>
                    <option value="Piccola">Piccola</option>
                    <option value="Grande">Grande</option>
                    <option value="A U">A U</option>
                    <option value="A L">A L</option>
                  </select>
                </div>
                <div class="field">
                  <label for="cucina">Cucina</label>
                  <select id="cucina" name="cucina">
                    <option value="">-- Seleziona --</option>
                    <option value="Lineare">Lineare</option>
                    <option value="Angolare">Angolare</option>
                  </select>
                </div>
                <div class="field">
                  <label for="bagno">Bagno</label>
                  <select id="bagno" name="bagno">
                    <option value="">-- Seleziona --</option>
                    <option value="Assente">Assente</option>
                    <option value="WC chimico">WC chimico</option>
                    <option value="WC + doccia">WC + doccia</option>
                  </select>
                </div>
                <div class="field">
                  <label for="docciaSeparata">Doccia separata</label>
                  <select id="docciaSeparata" name="docciaSeparata">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="armadi">Armadi</label>
                  <select id="armadi" name="armadi">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="gavoniInterni">Gavoni interni</label>
                  <select id="gavoniInterni" name="gavoniInterni">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
              </div>
            </details>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Impianti & accessori</summary>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="presa220Esterna">Presa 220V esterna</label>
                  <select id="presa220Esterna" name="presa220Esterna">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="impianto12V">Impianto 12V</label>
                  <select id="impianto12V" name="impianto12V">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="batteriaServizi">Batteria servizi</label>
                  <select id="batteriaServizi" name="batteriaServizi">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="illuminazioneLed">Illuminazione LED</label>
                  <select id="illuminazioneLed" name="illuminazioneLed">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="impiantoGas">Impianto gas</label>
                  <select id="impiantoGas" name="impiantoGas">
                    <option value="">-- Seleziona --</option>
                    <option value="A norma">A norma</option>
                    <option value="Da verificare">Da verificare</option>
                  </select>
                </div>
                <div class="field">
                  <label for="numeroBombole">Numero bombole</label>
                  <input id="numeroBombole" name="numeroBombole" type="number" inputmode="numeric" min="0" step="1" />
                </div>
                <div class="field">
                  <label for="scadenzaImpiantoGas">Scadenza impianto gas</label>
                  <input id="scadenzaImpiantoGas" name="scadenzaImpiantoGas" type="date" />
                </div>
                <div class="field">
                  <label for="serbatoioAcquaPulita">Serbatoio acqua pulita</label>
                  <select id="serbatoioAcquaPulita" name="serbatoioAcquaPulita">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="serbatoioAcqueGrigie">Serbatoio acque grigie</label>
                  <select id="serbatoioAcqueGrigie" name="serbatoioAcqueGrigie">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="riscaldamento">Riscaldamento</label>
                  <select id="riscaldamento" name="riscaldamento">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="tipoRiscaldamento">Tipo riscaldamento</label>
                  <select id="tipoRiscaldamento" name="tipoRiscaldamento">
                    <option value="">-- Seleziona --</option>
                    <option value="Truma">Truma</option>
                    <option value="Elettrico">Elettrico</option>
                    <option value="Altro">Altro</option>
                  </select>
                </div>
                <div class="field">
                  <label for="climatizzatore">Climatizzatore</label>
                  <select id="climatizzatore" name="climatizzatore">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="predisposizioneClima">Predisposizione clima</label>
                  <select id="predisposizioneClima" name="predisposizioneClima">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="verandaTendalino">Veranda / tendalino</label>
                  <select id="verandaTendalino" name="verandaTendalino">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field">
                  <label for="portabici">Portabici</label>
                  <select id="portabici" name="portabici">
                    <option value="">-- Seleziona --</option>
                    <option value="Sì">Sì</option>
                    <option value="No">No</option>
                  </select>
                </div>
              </div>
            </details>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Contatti & media</summary>
              <div class="form-grid" style="margin-top:12px">
                <div class="field">
                  <label for="contattoTelefono">Telefono</label>
                  <input id="contattoTelefono" name="contattoTelefono" type="tel" autocomplete="tel" />
                </div>
                <div class="field">
                  <label for="contattoWhatsapp">WhatsApp</label>
                  <input id="contattoWhatsapp" name="contattoWhatsapp" type="tel" autocomplete="tel" />
                </div>
                <div class="field">
                  <label for="contattoEmail">Email</label>
                  <input id="contattoEmail" name="contattoEmail" type="email" autocomplete="email" />
                </div>
                <div class="field">
                  <label for="localita">Località</label>
                  <input id="localita" name="localita" autocomplete="address-level2" />
                </div>
                <div class="field">
                  <label for="orariContatto">Orari di contatto</label>
                  <input id="orariContatto" name="orariContatto" autocomplete="off" placeholder="es. 9-12 / 15-19" />
                </div>
                <div class="field">
                  <label for="videoUrl">Video (URL)</label>
                  <input id="videoUrl" name="videoUrl" type="url" autocomplete="off" placeholder="https://..." />
                  <div id="videoPreview" class="hint" style="margin-top:6px"></div>
                </div>
                <div class="field">
                  <label for="planimetriaUrl">Planimetria (URL)</label>
                  <input id="planimetriaUrl" name="planimetriaUrl" type="url" autocomplete="off" placeholder="https://..." />
                </div>
              </div>
            </details>

            <details style="margin-top:12px" open>
              <summary style="cursor:pointer;font-weight:900">Caratteristiche</summary>
              <div class="hint" style="margin-top:6px">Seleziona le caratteristiche. Puoi aggiungerne di nuove (salvate nel database).</div>
              <div class="inline-row" style="margin-top:10px">
                <input id="featureSearch" placeholder="Cerca…" autocomplete="off" />
                <input id="newFeatureInput" placeholder="Nuova caratteristica…" autocomplete="off" />
                <button class="btn btn-primary" type="button" id="addFeatureBtn">Aggiungi</button>
                <button class="btn" type="button" id="resetAutoFeaturesBtn">Reset auto</button>
              </div>
              <div id="featuresGrid" class="choice-grid" style="margin-top:10px"></div>
              <div id="featureMatches" class="hint" style="margin-top:10px"></div>
            </details>

            <details style="margin-top:10px">
              <summary style="cursor:pointer;font-weight:900">Note riservate</summary>
              <div class="hint" style="margin-top:6px">Visibili solo in admin (cifrate nel database).</div>
              <div class="choice-box" style="margin-top:10px">
                <label class="choice-item" for="adminNoteOnly">
                  <input id="adminNoteOnly" type="checkbox" checked disabled />
                  Solo admin
                </label>
              </div>
              <div class="field" style="margin-top:10px">
                <label for="adminNote">Testo</label>
                <textarea id="adminNote" rows="4" placeholder="Note interne: difetti, trattativa, costi, info riservate…"></textarea>
              </div>
            </details>

            <div class="form-grid" style="margin-top:12px">
              <div class="field" style="grid-column:1/-1">
                <label for="note">Note (Descrizione)</label>
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px">
                   <span class="hint">Generata automaticamente dai dati tecnici, ma modificabile. <span id="noteStats"></span></span>
                   <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
                     <div class="choice-box" style="padding:6px 8px">
                       <label class="choice-item" style="margin:0"><input type="radio" name="noteMode" value="wysiwyg" checked />Editor</label>
                       <label class="choice-item" style="margin:0"><input type="radio" name="noteMode" value="text" />Testo</label>
                     </div>
                     <select id="descMode" class="btn" style="padding:4px 8px;font-size:0.8rem">
                       <option value="rewrite" selected>Rielabora (più bello)</option>
                       <option value="shorten">Accorcia</option>
                       <option value="bullets">Formato elenco</option>
                     </select>
                     <select id="descAiMode" class="btn" style="padding:4px 8px;font-size:0.8rem">
                       <option value="local" selected>AI Locale (senza API)</option>
                       <option value="server">AI Server (API)</option>
                     </select>
                     <button type="button" class="btn btn-primary" style="padding:4px 8px;font-size:0.8rem" id="descAiBtn">AI: Applica</button>
                     <button type="button" class="btn" style="padding:4px 8px;font-size:0.8rem" id="descSuggestBtn">AI: Suggerisci campi</button>
                     <button type="button" class="btn" style="padding:4px 8px;font-size:0.8rem" id="descUndoBtn" disabled>Annulla</button>
                     <button type="button" class="btn" style="padding:4px 8px;font-size:0.8rem" id="dictationBtn">Detta</button>
                     <button type="button" class="btn" style="padding:4px 8px;font-size:0.8rem" onclick="generateDescription()">Rigenera</button>
                   </div>
                </div>
                <div id="dictationStatus" class="hint" style="margin-bottom:6px"></div>
                <div style="display:grid">
                  <div class="editor-toolbar">
                    <button type="button" class="editor-btn" onclick="formatDoc('bold')" title="Grassetto">B</button>
                    <button type="button" class="editor-btn" onclick="formatDoc('italic')" title="Corsivo">I</button>
                    <button type="button" class="editor-btn" onclick="formatDoc('underline')" title="Sottolineato">U</button>
                    <div style="width:1px;background:var(--border);margin:0 4px"></div>
                    <button type="button" class="editor-btn" onclick="formatDoc('insertUnorderedList')" title="Elenco puntato">• Lista</button>
                    <button type="button" class="editor-btn" onclick="formatDoc('insertOrderedList')" title="Elenco numerato">1. Lista</button>
                  </div>
                  <!-- Semplice textarea, ma l'utente chiedeva WYSIWYG. 
                       Per una vera WYSIWYG senza dipendenze, contenteditable è meglio.
                       Uso un div contenteditable che sincronizzo con una textarea nascosta. -->
                  <div id="editor" contenteditable="true" style="min-height:120px;padding:12px;border:1px solid var(--border);border-top:none;border-radius:0 0 12px 12px;background:rgba(255,255,255,.05);outline:none"></div>
                  <textarea id="noteText" rows="8" style="display:none;min-height:120px;padding:12px;border:1px solid var(--border);border-top:none;border-radius:0 0 12px 12px;background:rgba(255,255,255,.05);outline:none"></textarea>
                  <textarea id="note" name="note" hidden></textarea>
                </div>
                <div id="dictationLive" class="hint" style="margin-top:6px"></div>
              </div>
            </div>

              </div>
              <aside class="new-form-sidebar" aria-label="Riepilogo e azioni">
                <div class="card new-sidebar-card">
                  <div id="newFormChecklist" class="checklist">
                    <div class="checklist-title">Requisiti minimi</div>
                    <div class="checklist-grid">
                      <div class="check-item" data-key="marca"><span class="check-dot" aria-hidden="true"></span><span>Marca</span></div>
                      <div class="check-item" data-key="modello"><span class="check-dot" aria-hidden="true"></span><span>Modello</span></div>
                      <div class="check-item" data-key="prezzo"><span class="check-dot" aria-hidden="true"></span><span>Prezzo</span></div>
                      <div class="check-item" data-key="anno"><span class="check-dot" aria-hidden="true"></span><span>Anno</span></div>
                      <div class="check-item" data-key="tipologiaMezzo"><span class="check-dot" aria-hidden="true"></span><span>Tipologia</span></div>
                      <div class="check-item" data-key="foto"><span class="check-dot" aria-hidden="true"></span><span>Foto (per pubblicare)</span></div>
                    </div>
                    <div id="newFormChecklistHint" class="hint" style="margin-top:8px"></div>
                  </div>

                  <div style="margin-top:14px">
                    <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
                      <div>
                        <div style="font-weight:900">Foto</div>
                        <div class="hint">Trascina le immagini o clicca per selezionare.</div>
                        <div class="hint" id="photoCount" style="margin-top:6px"></div>
                      </div>
                    </div>

                    <div class="inline-row" style="margin-top:10px">
                      <input id="photoUrlInput" type="url" placeholder="Incolla URL immagine https://..." />
                      <button class="btn" type="button" id="addPhotoUrlBtn">Aggiungi URL</button>
                      <button class="btn" type="button" id="autoAltBtn">Auto ALT</button>
                      <button class="btn btn-danger" type="button" id="clearPhotosBtn">Svuota</button>
                    </div>

                    <div id="dropzone" class="dropzone" style="margin-top:10px">
                      <p style="color:var(--muted); pointer-events:none; margin-bottom:10px">Trascina le foto qui o clicca nell'area</p>
                      <button type="button" class="btn" style="pointer-events:none">Seleziona file</button>
                      <input id="photosInput" name="photosInput" type="file" accept="image/*" multiple style="display:none" />
                    </div>

                    <div id="photosPreview" class="photos" aria-label="Anteprima foto"></div>
                    <div id="photoHint" class="hint" style="margin-top:10px"></div>
                  </div>
                </div>

                <div class="row-actions sticky new-actions">
                  <button class="btn" type="button" id="goListBtn">Vai all'elenco</button>
                  <button class="btn" type="button" id="saveAndPublishBtn">Salva e pubblica</button>
                  <button class="btn btn-primary" type="submit">Salva scheda</button>
                </div>
                <div id="formMsg" class="error" hidden></div>
                <progress id="uploadProg" value="0" max="100" style="width:100%;display:none"></progress>
              </aside>
            </div>
          </form>
        </div>
      </section>

      <section id="list" class="section" aria-label="Elenco roulotte">
        <div class="row-actions" style="justify-content:flex-end"><button class="btn" type="button" data-help-target="help-list">Guida</button></div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
            <div>
              <div style="font-weight:900;font-size:1.1rem">Elenco</div>
              <div class="hint" id="listMeta" style="margin-top:6px"></div>
            </div>
            <div class="filters" role="search" aria-label="Ricerca elenco">
              <div class="field">
                <label for="listQ">Cerca</label>
                <input id="listQ" name="listQ" type="search" autocomplete="off" placeholder="Marca, modello, anno..." />
              </div>
              <div class="field">
                <label for="listCategory">Categoria</label>
                <select id="listCategory" name="listCategory">
                  <option value="">Tutte</option>
                </select>
              </div>
              <div class="field">
                <label for="listStato">Stato</label>
                <select id="listStato" name="listStato">
                  <option value="">Tutti</option>
                  <option value="Ottimo">Ottimo</option>
                  <option value="Buono">Buono</option>
                  <option value="Da sistemare">Da sistemare</option>
                  <option value="Nuovo">Nuovo</option>
                  <option value="Venduto">Venduto</option>
                </select>
              </div>
              <div class="field">
                <label for="listAnnuncio">Pubblicazione</label>
                <select id="listAnnuncio" name="listAnnuncio">
                  <option value="">Tutte</option>
                  <option value="bozza">Bozza</option>
                  <option value="verifica">Verifica</option>
                  <option value="pubblicato">Pubblicato</option>
                  <option value="venduto">Venduto</option>
                </select>
              </div>
              <div class="field" style="min-width:auto">
                <label class="sr-only" for="listReset">Pulisci filtri</label>
                <button class="btn" type="button" id="listReset">Pulisci filtri</button>
              </div>
            </div>
          </div>

          <div style="margin-top:6px;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:flex-end">
            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end">
              <div class="field" style="min-width:220px">
                <label for="shareTitle">Titolo condivisione</label>
                <input id="shareTitle" type="text" autocomplete="off" placeholder="Es. Selezione per cliente Rossi" />
              </div>
              <div class="field" style="min-width:160px">
                <label for="shareExpires">Scadenza</label>
                <select id="shareExpires">
                  <option value="1">1 giorno</option>
                  <option value="7" selected>7 giorni</option>
                  <option value="30">30 giorni</option>
                </select>
              </div>
              <button class="btn" type="button" id="shareClearSel">Pulisci selezione</button>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end">
              <div class="hint" id="shareSelCount"></div>
              <button class="btn btn-primary" type="button" id="shareCreateBtn">Crea link selezione</button>
            </div>
          </div>

          <div style="margin-top:8px" class="table-wrap" aria-label="Tabella roulotte">
            <table>
              <thead>
                <tr>
                  <th style="width:52px">Sel.</th>
                  <th style="width:74px">Foto</th>
                  <th>Roulotte</th>
                  <th>Anno</th>
                  <th>Prezzo</th>
                  <th>Stato</th>
                  <th>Pubblicazione</th>
                  <th>Azioni</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="detail" class="section" aria-label="Dettaglio mezzo">
        <div class="row-actions" style="justify-content:flex-end"><button class="btn" type="button" data-help-target="help-detail">Guida</button></div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
            <div>
              <div style="font-weight:900;font-size:1.1rem" id="detailTitle">Dettaglio</div>
              <div class="hint" id="detailMeta" style="margin-top:6px"></div>
            </div>
            <div class="row-actions" style="justify-content:flex-end">
              <button class="btn" type="button" id="detailBackBtn">Torna all'elenco</button>
              <button class="btn" type="button" id="detailOpenPublicBtn">Apri sul sito</button>
              <button class="btn" type="button" id="detailDuplicateBtn">Duplica</button>
              <button class="btn" type="button" id="detailSoldBtn">Segna venduto</button>
              <button class="btn" type="button" id="detailHistoryBtn">Cronologia</button>
              <button class="btn" type="button" id="detailExportSubitoBtn">Esporta Subito.it</button>
              <button class="btn" type="button" id="detailExportFbBtn">Esporta Marketplace</button>
              <button class="btn" type="button" id="detailBmSubitoBtn">Bookmarklet Subito</button>
              <button class="btn" type="button" id="detailBmFbBtn">Bookmarklet Marketplace</button>
              <button class="btn btn-primary" type="button" id="detailEditBtn">Modifica</button>
            </div>
          </div>

          <details class="help-card" style="margin-top:10px">
            <summary>Guida automatizzazione pubblicazione</summary>
            <div class="help-grid" style="display:grid;gap:10px">
              <div class="card" style="padding:12px">
                <div class="card-title" style="margin-bottom:6px">Bookmarklet Subito.it</div>
                <ol style="display:grid;gap:6px;padding-left:18px">
                  <li>Apri il dettaglio del mezzo in Admin.</li>
                  <li>Clicca “Bookmarklet Subito”: viene creato un link e copiato negli appunti.</li>
                  <li>Trascina il link nella barra dei Preferiti del browser.</li>
                  <li>Vai su Subito.it nella pagina “Nuova inserzione”.</li>
                  <li>Clicca il Preferito “Bookmarklet Subito”: i campi si precompilano.</li>
                  <li>Controlla i campi, carica le immagini e pubblica.</li>
                </ol>
              </div>
              <div class="card" style="padding:12px">
                <div class="card-title" style="margin-bottom:6px">Bookmarklet Marketplace</div>
                <ol style="display:grid;gap:6px;padding-left:18px">
                  <li>Apri il dettaglio del mezzo in Admin.</li>
                  <li>Clicca “Bookmarklet Marketplace”: viene creato un link e copiato negli appunti.</li>
                  <li>Trascina il link nella barra dei Preferiti del browser.</li>
                  <li>Vai su Facebook Marketplace nella pagina “Nuova inserzione”.</li>
                  <li>Clicca il Preferito “Bookmarklet Marketplace”: i campi si precompilano.</li>
                  <li>Controlla i campi, carica le immagini e pubblica.</li>
                </ol>
              </div>
              <div class="card" style="padding:12px">
                <div class="card-title" style="margin-bottom:6px">Feed automatici</div>
                <div class="hint" style="margin-bottom:8px">Collega i portali ai feed per pubblicazione 100% automatica.</div>
                <ul style="display:grid;gap:6px;padding-left:18px">
                  <li>Subito CSV: <a id="autoFeedSubitoUrl" href="#" target="_blank" rel="noopener">—</a></li>
                  <li>Marketplace JSON: <a id="autoFeedMarketplaceUrl" href="#" target="_blank" rel="noopener">—</a></li>
                </ul>
                <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
                  <button class="btn" type="button" id="autoFeedStatusBtn">Aggiorna stato</button>
                  <div class="hint" id="autoFeedStatus">Stato: —</div>
                </div>
                <ol style="display:grid;gap:6px;padding-left:18px;margin-top:10px">
                  <li>Nel portale, configura “Recurring fetch” o ingest del feed con l’URL sopra.</li>
                  <li>Imposta frequenza di aggiornamento secondo preferenza.</li>
                  <li>Verifica qui lo stato e correggi eventuali errori segnalati.</li>
                </ol>
              </div>
            </div>
          </details>

          <div class="grid" style="margin-top:14px">
            <div class="card span-7">
              <div class="card-title" style="margin-bottom:10px">Foto</div>
              <div id="detailPhotos" class="photos" aria-label="Foto mezzo"></div>
            </div>
            <div class="card span-5">
              <div class="card-title" style="margin-bottom:10px">Dettagli</div>
              <div id="detailInfo" style="display:grid;gap:10px"></div>
            </div>
            <div class="card span-12">
              <div class="card-title" style="margin-bottom:10px">Descrizione</div>
              <div id="detailNote" style="color:var(--text)"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="categories" class="section" aria-label="Gestione Categorie">
        <div class="row-actions" style="justify-content:flex-end"><button class="btn" type="button" data-help-target="help-categories">Guida</button></div>
        <div class="grid">
          <div class="card span-5">
            <div class="card-title" style="margin-bottom:10px">Gestione</div>
            <div class="inline-row" style="margin-bottom:12px">
              <div class="field" style="min-width:240px">
                <label for="newCatName">Nuova categoria</label>
                <input id="newCatName" placeholder="Es. Caravan Nuove" />
              </div>
              <div style="display:flex;justify-content:flex-end">
                <button class="btn btn-primary" type="button" id="addCatBtn">Aggiungi</button>
              </div>
            </div>
            <div id="catList"></div>
          </div>
          <div class="card span-7">
            <div class="card-title" style="margin-bottom:10px">Panoramica</div>
            <div class="hint" style="margin-bottom:12px">Clicca una categoria per aprire l'elenco filtrato.</div>
            <div id="categoriesGrid" class="grid" style="grid-template-columns:repeat(auto-fill, minmax(220px, 1fr));gap:10px"></div>
          </div>
        </div>
      </section>

      <section id="settings" class="section" aria-label="Amministrazione">
        <div class="row-actions" style="justify-content:flex-end"><button class="btn" type="button" data-help-target="help-settings">Guida</button></div>
        <div class="grid">
          <div class="card span-6">
            <div style="font-weight:900;font-size:1.05rem">Sicurezza Admin</div>
            <div class="hint" style="margin-top:6px">Modifica le credenziali di accesso.</div>
            
            <form id="securityForm" style="margin-top:12px">
               <div class="field">
                 <label for="newAuthUser">Nuovo Username</label>
                 <input id="newAuthUser" required />
               </div>
               <div class="field" style="margin-top:8px">
                 <label for="newAuthPass">Nuova Password</label>
                 <input id="newAuthPass" type="password" required />
               </div>
               <div class="row-actions">
                 <button class="btn btn-primary" type="submit">Aggiorna Credenziali</button>
               </div>
               <div id="secMsg" class="error ok" hidden style="background:rgba(16,185,129,.16);border-color:rgba(16,185,129,.35);color:#a7f3d0"></div>
            </form>
          </div>
          <div class="card span-6">
            <div style="font-weight:900;font-size:1.05rem">Esporta Dati</div>
            <div class="hint" style="margin-top:6px">Scarica il database completo in un file.</div>
            <div class="row-actions" style="justify-content:flex-start">
              <button class="btn btn-primary" type="button" id="exportBtn">Esporta</button>
            </div>
          </div>
          <div class="card span-6">
            <div style="font-weight:900;font-size:1.05rem">Statistiche Sito</div>
            <div class="hint" style="margin-top:6px">Visibili solo in area Admin.</div>
            <div style="display:grid;grid-template-columns:repeat(3, minmax(0, 1fr));gap:10px;margin-top:12px">
              <div class="card" style="padding:12px">
                <div class="label" style="font-size:0.8rem">Aggiornamento</div>
                <div class="value" id="siteStatsUpdatedAt">—</div>
              </div>
              <div class="card" style="padding:12px">
                <div class="label" style="font-size:0.8rem">Totale schede</div>
                <div class="value" id="siteStatsTotal">0</div>
              </div>
              <div class="card" style="padding:12px">
                <div class="label" style="font-size:0.8rem">Risultati</div>
                <div class="value" id="siteStatsResults">0</div>
              </div>
            </div>
          </div>
          <div class="card span-6">
            <div style="font-weight:900;font-size:1.05rem">Importa JSON</div>
            <div class="hint" style="margin-top:6px">Carica un backup per sostituire i dati.</div>
            <div class="row-actions" style="justify-content:flex-start;align-items:center">
              <input id="importInput" type="file" accept="application/json" />
              <button class="btn" type="button" id="importBtn">Importa</button>
            </div>
            <div id="importMsg" class="error" hidden></div>
          </div>
          <div class="card span-6">
            <div style="font-weight:900;font-size:1.05rem">Sync Server</div>
            <div class="hint" style="margin-top:6px">Sincronizza il database con il server locale (dev-server).</div>
            <div class="row-actions" style="justify-content:flex-start;align-items:center;flex-wrap:wrap">
              <button class="btn btn-primary" type="button" id="syncNowBtn">Sincronizza</button>
              <button class="btn" type="button" id="pullServerBtn">Scarica</button>
              <button class="btn" type="button" id="pushServerBtn">Carica</button>
            </div>
            <div id="syncMsg" class="error ok" hidden style="background:rgba(16,185,129,.16);border-color:rgba(16,185,129,.35);color:#a7f3d0"></div>
          </div>
          <div class="card span-12" id="adminUsersCard">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
              <div>
                <div style="font-weight:900;font-size:1.05rem">Utenti Admin</div>
                <div class="hint" style="margin-top:6px">Crea e gestisci gli accessi per più persone.</div>
                <div class="hint" id="adminUsersRole" style="margin-top:6px">Accesso: —</div>
              </div>
              <div class="row-actions" style="justify-content:flex-start;align-items:center;flex-wrap:wrap">
                <button class="btn" type="button" id="adminUsersRefreshBtn">Aggiorna</button>
              </div>
            </div>
            <div id="adminUsersMsg" class="error" hidden style="margin-top:10px"></div>
            <div id="adminUsersLocked" class="hint" hidden style="margin-top:10px">
              Non hai i permessi per gestire l’elenco utenti (ruolo Superuser richiesto).
            </div>

            <details id="adminResetDetails" style="margin-top:12px">
              <summary style="cursor:pointer;font-weight:900;color:var(--text)">Aggiungi / resetta utente con codice reset</summary>
              <div class="hint" style="margin-top:6px">Se hai il codice reset, puoi creare o reimpostare la password di un utente admin.</div>
              <form id="adminResetUserForm" style="margin-top:10px">
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:10px;align-items:end">
                  <div class="field">
                    <label for="adminResetCode">Codice reset</label>
                    <input id="adminResetCode" autocomplete="off" />
                  </div>
                  <div class="field">
                    <label for="adminResetUsername">Username</label>
                    <input id="adminResetUsername" autocomplete="off" />
                  </div>
                  <div class="field">
                    <label for="adminResetPassword">Password</label>
                    <input id="adminResetPassword" type="password" autocomplete="new-password" />
                  </div>
                  <button class="btn btn-primary" type="submit">Esegui</button>
                </div>
                <div id="adminResetUserMsg" class="error ok" hidden style="margin-top:10px;background:rgba(16,185,129,.16);border-color:rgba(16,185,129,.35);color:#a7f3d0"></div>
              </form>
            </details>

            <form id="adminUsersCreateForm" style="margin-top:12px">
              <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:10px;align-items:end">
                <div class="field">
                  <label for="adminNewUsername">Username</label>
                  <input id="adminNewUsername" autocomplete="off" required />
                </div>
                <div class="field">
                  <label for="adminNewPassword">Password</label>
                  <input id="adminNewPassword" type="password" autocomplete="new-password" required />
                </div>
                <button class="btn btn-primary" type="submit">Crea utente</button>
              </div>
            </form>

            <div id="adminUsersList" style="margin-top:14px"></div>
          </div>
          <div class="card span-12">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap">
              <div>
                <div style="font-weight:900;font-size:1.05rem">Pulizia</div>
                <div class="hint" style="margin-top:6px">Elimina tutti i dati salvati nel browser.</div>
              </div>
              <button class="btn btn-danger" type="button" id="wipeBtn">Elimina dati locali</button>
            </div>
          </div>
        </div>
      </section>
      <section id="help" class="section" aria-label="Guida" hidden>
        <div class="grid">
          <div class="card span-12" id="help-overview">
            <div style="font-weight:900;font-size:1.1rem">Guida semplice all’area Amministrazione</div>
            <div class="hint" style="margin-top:6px">Spiegazione pratica di ogni sezione e dei pulsanti principali.</div>
          </div>
          <div class="card span-12" id="help-login">
            <div class="card-title" style="margin-bottom:8px">Accesso offline/online</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Online: avvia il server e apri http://localhost:3001/admin.html, poi accedi con le credenziali configurate.</li>
              <li>Offline (file): apri admin.html dal disco e usa le credenziali locali configurate; imposta “API personalizzata” se vuoi collegarti al server.</li>
              <li>Diagnostica: API/WS/Stato mostrano l’endpoint corrente e lo stato di salute.</li>
              <li>Sblocco: usa “Sblocca accesso offline” se hai troppi tentativi falliti.</li>
            </ul>
          </div>
          <div class="card span-12" id="help-dashboard">
            <div class="card-title" style="margin-bottom:8px">Dashboard</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Aggiorna: ricarica dati e statistiche.</li>
              <li>Sito: apre il sito pubblico.</li>
              <li>Assistente rapido: esegue comandi utili (es. “duplica ABC123”).</li>
            </ul>
            <div class="row-actions" style="justify-content:flex-start"><button class="btn" type="button" data-section-target="dashboard">Torna a Dashboard</button></div>
          </div>
          <div class="card span-12" id="help-new">
            <div class="card-title" style="margin-bottom:8px">Nuova Roulotte</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Compila Marca, Modello, Prezzo, Anno, Tipologia.</li>
              <li>Foto: trascina immagini; la prima è la copertina.</li>
              <li>Salva scheda: memorizza nel database; “Salva e pubblica” imposta Pubblicazione.</li>
              <li>Editor descrizione: puoi scrivere o usare AI per rielaborare.</li>
            </ul>
            <div class="row-actions" style="justify-content:flex-start"><button class="btn" type="button" data-section-target="new">Torna a Nuova Roulotte</button></div>
          </div>
          <div class="card span-12" id="help-list">
            <div class="card-title" style="margin-bottom:8px">Elenco</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Filtri: cerca per testo, categoria, stato, pubblicazione.</li>
              <li>Selezione: crea link condivisibile con scadenza.</li>
              <li>Azioni riga: apri dettaglio, duplica, venduto, esporta.</li>
            </ul>
            <div class="row-actions" style="justify-content:flex-start"><button class="btn" type="button" data-section-target="list">Torna a Elenco</button></div>
          </div>
          <div class="card span-12" id="help-detail">
            <div class="card-title" style="margin-bottom:8px">Dettaglio</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Foto e Dettagli: verifica le informazioni.</li>
              <li>Duplica: crea una nuova scheda partendo da questa.</li>
              <li>Segna venduto: aggiorna stato e nasconde dal pubblico.</li>
              <li>Esporta: genera dati per Subito.it e Marketplace.</li>
            </ul>
            <div class="row-actions" style="justify-content:flex-start"><button class="btn" type="button" data-section-target="detail">Torna a Dettaglio</button></div>
          </div>
          <div class="card span-12" id="help-categories">
            <div class="card-title" style="margin-bottom:8px">Categorie</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Aggiungi: crea una nuova categoria.</li>
              <li>Panoramica: clicca per vedere l’elenco filtrato.</li>
            </ul>
            <div class="row-actions" style="justify-content:flex-start"><button class="btn" type="button" data-section-target="categories">Torna a Categorie</button></div>
          </div>
          <div class="card span-12" id="help-settings">
            <div class="card-title" style="margin-bottom:8px">Impostazioni</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Sicurezza Admin: cambia username e password.</li>
              <li>Esporta/Importa: backup e ripristino del database.</li>
              <li>Sync Server: sincronizza con il server di sviluppo.</li>
              <li>Utenti Admin: gestisci accessi multipli.</li>
              <li>Pulizia: elimina dati salvati nel browser.</li>
            </ul>
            <div class="row-actions" style="justify-content:flex-start"><button class="btn" type="button" data-section-target="settings">Torna a Impostazioni</button></div>
          </div>
          <div class="card span-12" id="help-content">
            <div class="card-title" style="margin-bottom:8px">Contenuti</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Chiave: seleziona cosa modificare (es. footer).</li>
              <li>Tipo: HTML, Markdown o Testo semplice.</li>
              <li>Anteprima: verifica il risultato prima di pubblicare.</li>
            </ul>
            <div class="row-actions" style="justify-content:flex-start"><button class="btn" type="button" data-section-target="content">Torna a Contenuti</button></div>
          </div>
          <div class="card span-12" id="help-media">
            <div class="card-title" style="margin-bottom:8px">Media</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Carica immagini: supporto multiplo; riuso automatico dove possibile.</li>
              <li>Copia URL: usa l’immagine nelle schede o nei contenuti.</li>
              <li>Elimina: rimuove l’elemento dall’archivio.</li>
            </ul>
            <div class="row-actions" style="justify-content:flex-start"><button class="btn" type="button" data-section-target="media">Torna a Media</button></div>
          </div>
          <div class="card span-12" id="help-live">
            <div class="card-title" style="margin-bottom:8px">Editor Live</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Attiva modifica: abilita la selezione degli elementi nel sito.</li>
              <li>Proprietà: aggiorna testo, link, immagini e alt.</li>
              <li>Blocchi: aggiungi o sposta paragrafi, CTA, immagini.</li>
              <li>Salva/Publlica: applica le modifiche al contenuto collegato.</li>
            </ul>
            <div class="row-actions" style="justify-content:flex-start"><button class="btn" type="button" data-section-target="live">Torna a Editor Live</button></div>
          </div>
          <div class="card span-12" id="help-tips">
            <div class="card-title" style="margin-bottom:8px">Suggerimenti generali</div>
            <ul style="display:grid;gap:6px;padding-left:18px">
              <li>Usa immagini leggere per velocità e spazio.</li>
              <li>Compila i campi obbligatori per poter pubblicare.</li>
              <li>Controlla sempre l’anteprima prima di pubblicare.</li>
            </ul>
          </div>
          <div class="card span-12" id="help-quick">
            <div class="card-title" style="margin-bottom:8px">Percorso rapido (pubblicazione)</div>
            <ol style="display:grid;gap:6px;padding-left:18px">
              <li>Vai su “Nuova Roulotte”, compila i campi obbligatori.</li>
              <li>Carica le foto (copertina = prima foto).</li>
              <li>Scrivi o rielabora la descrizione.</li>
              <li>Premi “Salva e pubblica”.</li>
              <li>Controlla nella “Elenco” lo stato Pubblicazione.</li>
            </ol>
            <div class="row-actions" style="justify-content:flex-start"><button class="btn" type="button" data-section-target="new">Inizia ora</button></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="roulotte-store.js"></script>
  <script src="live-reload.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
  <script src="https://unpkg.com/grapesjs"></script>
<script src="admin.js?v=20260120"></script>
</body>
</html>
